<?

	DSApi::reg_eventType( 'OnConnect', 'TSock::OnConnect', array('self','Connection'), 'TSock' );
	DSApi::reg_eventType( 'OnDisconnect', 'TSock::OnDisconnect', array('self','Connection'), 'TSock' );
	DSApi::reg_eventType( 'OnData', 'TSock::OnData', array('self','Connection', 'Data', 'Type'), 'TSock' );

	define("TSock_Public", 1);
	define("TSock_Private", 2);
	
	global $__TSock_Config;
	$__TSock_Config = array();
	
	Class TSock extends __TNoVisual 
	{
		Public $class_name_ex = __CLASS__;
		
		Public $V8JS;
		
		Public Function get_IsConnected()
		{
			global $__TSock_Config;
			return $__TSock_Config[$this->self]->IsConnected;
		}
		
		Public Function get_ID()
		{
			global $__TSock_Config;
			return $__TSock_Config[$this->self]->ID;
		}
		
		Public Function __inspectProperties()
		{
			return true;
		}
		
		Public Function __initComponentInfo()
		{
			parent::__initComponentInfo();
		}
		
		Public Function __construct($onwer=nil,$init=true,$self=nil)
		{
			parent::__construct($onwer, $init, $self);
			
			global $__TSock_Config;
			IF(!$__TSock_Config[$this->self])
			{
				$__TSock_Config[$this->self] = new stdClass;
				$__TSock_Config[$this->self]->IsConnected = false;
				$__TSock_Config[$this->self]->ID = null;
			}
			
			IF($init)
			{
				$this->IP = "127.0.0.1";
				$this->Port = 7777;
			}
		}
		
		Public Static Function OnConnect( $self, $Connection )
		{
			global $__TSock_Config;
			IF( !$Connection )
			{
				$__TSock_Config[$self]->IsConnected = true;
				return;
			}
			ELSEIF(!$__TSock_Config[$self]->ID)
			{
				$__TSock_Config[$self]->ID = $Connection;
				$Connection = null;
			}
			__exEvents::callEventEx( $self, array('Connection' => $Connection), 'OnConnect' );
		}
		
		Public Static Function OnDisconnect( $self, $Connection )
		{
			global $__TSock_Config;
			IF( !$Connection )
			{
				$__TSock_Config[$self]->IsConnected = false;
				$__TSock_Config[$self]->ID = null;
				$Connection = null;
			}
		
			__exEvents::callEventEx( $self, array('Connection' => $Connection), 'OnDisconnect' );
		}
		
		Public Static Function OnData( $self, $Connection, $Data, $Type )
		{
			__exEvents::callEventEx( $self, array('Connection' => $Connection, 'Data' => $Data, 'Type' => $Type), 'OnData' );
		}
		
		Public Function __TSockInit($self)
		{
			global $__TSock;
			IF(isset($__TSock[$self])) return; ELSE $__TSock[$self] = new V8JS;
			
			$V8JS = $__TSock[$self];
			
			$V8JS->Execute( base64_decode('LyohIFNvY2tldC5JTy5taW4uanMgYnVpbGQ6MC44LjcsIHByb2R1Y3Rpb24uIENvcHlyaWdodChjKSAyMDExIExlYXJuQm9vc3QgPGRldkBsZWFybmJvb3N0LmNvbT4gTUlUIExpY2Vuc2VkICovCihmdW5jdGlvbihhLGIpe3ZhciBjPWE7Yy52ZXJzaW9uPSIwLjguNyIsYy5wcm90b2NvbD0xLGMudHJhbnNwb3J0cz1bXSxjLmo9W10sYy5zb2NrZXRzPXt9LGMuY29ubmVjdD1mdW5jdGlvbihhLGQpe3ZhciBlPWMudXRpbC5wYXJzZVVyaShhKSxmLGc7YiYmYi5sb2NhdGlvbiYmKGUucHJvdG9jb2w9ZS5wcm90b2NvbHx8Yi5sb2NhdGlvbi5wcm90b2NvbC5zbGljZSgwLC0xKSxlLmhvc3Q9ZS5ob3N0fHwoYi5kb2N1bWVudD9iLmRvY3VtZW50LmRvbWFpbjpiLmxvY2F0aW9uLmhvc3RuYW1lKSxlLnBvcnQ9ZS5wb3J0fHxiLmxvY2F0aW9uLnBvcnQpLGY9Yy51dGlsLnVuaXF1ZVVyaShlKTt2YXIgaD17aG9zdDplLmhvc3Qsc2VjdXJlOiJodHRwcyI9PWUucHJvdG9jb2wscG9ydDplLnBvcnR8fCgiaHR0cHMiPT1lLnByb3RvY29sPzQ0Mzo4MCkscXVlcnk6ZS5xdWVyeXx8IiJ9O2MudXRpbC5tZXJnZShoLGQpO2lmKGhbImZvcmNlIG5ldyBjb25uZWN0aW9uIl18fCFjLnNvY2tldHNbZl0pZz1uZXcgYy5Tb2NrZXQoaCk7IWhbImZvcmNlIG5ldyBjb25uZWN0aW9uIl0mJmcmJihjLnNvY2tldHNbZl09ZyksZz1nfHxjLnNvY2tldHNbZl07cmV0dXJuIGcub2YoZS5wYXRoLmxlbmd0aD4xP2UucGF0aDoiIil9fSkoIm9iamVjdCI9PXR5cGVvZiBtb2R1bGU/bW9kdWxlLmV4cG9ydHM6dGhpcy5pbz17fSx0aGlzKSxmdW5jdGlvbihhLGIpe3ZhciBjPWEudXRpbD17fSxkPS9eKD86KD8hW146QF0rOlteOkBcL10qQCkoW146XC8/Iy5dKyk6KT8oPzpcL1wvKT8oKD86KChbXjpAXSopKD86OihbXjpAXSopKT8pP0ApPyhbXjpcLz8jXSopKD86OihcZCopKT8pKCgoXC8oPzpbXj8jXSg/IVtePyNcL10qXC5bXj8jXC8uXSsoPzpbPyNdfCQpKSkqXC8/KT8oW14/I1wvXSopKSg/Olw/KFteI10qKSk/KD86IyguKikpPykvLGU9WyJzb3VyY2UiLCJwcm90b2NvbCIsImF1dGhvcml0eSIsInVzZXJJbmZvIiwidXNlciIsInBhc3N3b3JkIiwiaG9zdCIsInBvcnQiLCJyZWxhdGl2ZSIsInBhdGgiLCJkaXJlY3RvcnkiLCJmaWxlIiwicXVlcnkiLCJhbmNob3IiXTtjLnBhcnNlVXJpPWZ1bmN0aW9uKGEpe3ZhciBiPWQuZXhlYyhhfHwiIiksYz17fSxmPTE0O3doaWxlKGYtLSljW2VbZl1dPWJbZl18fCIiO3JldHVybiBjfSxjLnVuaXF1ZVVyaT1mdW5jdGlvbihhKXt2YXIgYz1hLnByb3RvY29sLGQ9YS5ob3N0LGU9YS5wb3J0OyJkb2N1bWVudCJpbiBiPyhkPWR8fGRvY3VtZW50LmRvbWFpbixlPWV8fChjPT0iaHR0cHMiJiZkb2N1bWVudC5sb2NhdGlvbi5wcm90b2NvbCE9PSJodHRwczoiPzQ0Mzpkb2N1bWVudC5sb2NhdGlvbi5wb3J0KSk6KGQ9ZHx8ImxvY2FsaG9zdCIsIWUmJmM9PSJodHRwcyImJihlPTQ0MykpO3JldHVybihjfHwiaHR0cCIpKyI6Ly8iK2QrIjoiKyhlfHw4MCl9LGMucXVlcnk9ZnVuY3Rpb24oYSxiKXt2YXIgZD1jLmNodW5rUXVlcnkoYXx8IiIpLGU9W107Yy5tZXJnZShkLGMuY2h1bmtRdWVyeShifHwiIikpO2Zvcih2YXIgZiBpbiBkKWQuaGFzT3duUHJvcGVydHkoZikmJmUucHVzaChmKyI9IitkW2ZdKTtyZXR1cm4gZS5sZW5ndGg/Ij8iK2Uuam9pbigiJiIpOiIifSxjLmNodW5rUXVlcnk9ZnVuY3Rpb24oYSl7dmFyIGI9e30sYz1hLnNwbGl0KCImIiksZD0wLGU9Yy5sZW5ndGgsZjtmb3IoO2Q8ZTsrK2QpZj1jW2RdLnNwbGl0KCI9IiksZlswXSYmKGJbZlswXV09ZGVjb2RlVVJJQ29tcG9uZW50KGZbMV0pKTtyZXR1cm4gYn07dmFyIGY9ITE7Yy5sb2FkPWZ1bmN0aW9uKGEpe2lmKCJkb2N1bWVudCJpbiBiJiZkb2N1bWVudC5yZWFkeVN0YXRlPT09ImNvbXBsZXRlInx8ZilyZXR1cm4gYSgpO2Mub24oYiwibG9hZCIsYSwhMSl9LGMub249ZnVuY3Rpb24oYSxiLGMsZCl7YS5hdHRhY2hFdmVudD9hLmF0dGFjaEV2ZW50KCJvbiIrYixjKTphLmFkZEV2ZW50TGlzdGVuZXImJmEuYWRkRXZlbnRMaXN0ZW5lcihiLGMsZCl9LGMucmVxdWVzdD1mdW5jdGlvbihhKXtpZihhJiYidW5kZWZpbmVkIiE9dHlwZW9mIFhEb21haW5SZXF1ZXN0KXJldHVybiBuZXcgWERvbWFpblJlcXVlc3Q7aWYoInVuZGVmaW5lZCIhPXR5cGVvZiBYTUxIdHRwUmVxdWVzdCYmKCFhfHxjLnVhLmhhc0NPUlMpKXJldHVybiBuZXcgWE1MSHR0cFJlcXVlc3Q7aWYoIWEpdHJ5e3JldHVybiBuZXcgQWN0aXZlWE9iamVjdCgiTWljcm9zb2Z0LlhNTEhUVFAiKX1jYXRjaChiKXt9cmV0dXJuIG51bGx9LCJ1bmRlZmluZWQiIT10eXBlb2Ygd2luZG93JiZjLmxvYWQoZnVuY3Rpb24oKXtmPSEwfSksYy5kZWZlcj1mdW5jdGlvbihhKXtpZighYy51YS53ZWJraXR8fCJ1bmRlZmluZWQiIT10eXBlb2YgaW1wb3J0U2NyaXB0cylyZXR1cm4gYSgpO2MubG9hZChmdW5jdGlvbigpe3NldFRpbWVvdXQoYSwxMDApfSl9LGMubWVyZ2U9ZnVuY3Rpb24gZyhhLGIsZCxlKXt2YXIgZj1lfHxbXSxnPXR5cGVvZiBkPT0idW5kZWZpbmVkIj8yOmQsaDtmb3IoaCBpbiBiKWIuaGFzT3duUHJvcGVydHkoaCkmJmMuaW5kZXhPZihmLGgpPDAmJih0eXBlb2YgYVtoXSE9Im9iamVjdCJ8fCFnPyhhW2hdPWJbaF0sZi5wdXNoKGJbaF0pKTpjLm1lcmdlKGFbaF0sYltoXSxnLTEsZikpO3JldHVybiBhfSxjLm1peGluPWZ1bmN0aW9uKGEsYil7Yy5tZXJnZShhLnByb3RvdHlwZSxiLnByb3RvdHlwZSl9LGMuaW5oZXJpdD1mdW5jdGlvbihhLGIpe2Z1bmN0aW9uIGMoKXt9Yy5wcm90b3R5cGU9Yi5wcm90b3R5cGUsYS5wcm90b3R5cGU9bmV3IGN9LGMuaXNBcnJheT1BcnJheS5pc0FycmF5fHxmdW5jdGlvbihhKXtyZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGEpPT09IltvYmplY3QgQXJyYXldIn0sYy5pbnRlcnNlY3Q9ZnVuY3Rpb24oYSxiKXt2YXIgZD1bXSxlPWEubGVuZ3RoPmIubGVuZ3RoP2E6YixmPWEubGVuZ3RoPmIubGVuZ3RoP2I6YTtmb3IodmFyIGc9MCxoPWYubGVuZ3RoO2c8aDtnKyspfmMuaW5kZXhPZihlLGZbZ10pJiZkLnB1c2goZltnXSk7cmV0dXJuIGR9LGMuaW5kZXhPZj1mdW5jdGlvbihhLGIsYyl7aWYoQXJyYXkucHJvdG90eXBlLmluZGV4T2YpcmV0dXJuIEFycmF5LnByb3RvdHlwZS5pbmRleE9mLmNhbGwoYSxiLGMpO2Zvcih2YXIgZD1hLmxlbmd0aCxjPWM8MD9jK2Q8MD8wOmMrZDpjfHwwO2M8ZCYmYVtjXSE9PWI7YysrKTtyZXR1cm4gZDw9Yz8tMTpjfSxjLnRvQXJyYXk9ZnVuY3Rpb24oYSl7dmFyIGI9W107Zm9yKHZhciBjPTAsZD1hLmxlbmd0aDtjPGQ7YysrKWIucHVzaChhW2NdKTtyZXR1cm4gYn0sYy51YT17fSxjLnVhLmhhc0NPUlM9InVuZGVmaW5lZCIhPXR5cGVvZiBYTUxIdHRwUmVxdWVzdCYmZnVuY3Rpb24oKXt0cnl7dmFyIGE9bmV3IFhNTEh0dHBSZXF1ZXN0fWNhdGNoKGIpe3JldHVybiExfXJldHVybiBhLndpdGhDcmVkZW50aWFscyE9dW5kZWZpbmVkfSgpLGMudWEud2Via2l0PSJ1bmRlZmluZWQiIT10eXBlb2YgbmF2aWdhdG9yJiYvd2Via2l0L2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KX0oInVuZGVmaW5lZCIhPXR5cGVvZiBpbz9pbzptb2R1bGUuZXhwb3J0cyx0aGlzKSxmdW5jdGlvbihhLGIpe2Z1bmN0aW9uIGMoKXt9YS5FdmVudEVtaXR0ZXI9YyxjLnByb3RvdHlwZS5vbj1mdW5jdGlvbihhLGMpe3RoaXMuJGV2ZW50c3x8KHRoaXMuJGV2ZW50cz17fSksdGhpcy4kZXZlbnRzW2FdP2IudXRpbC5pc0FycmF5KHRoaXMuJGV2ZW50c1thXSk/dGhpcy4kZXZlbnRzW2FdLnB1c2goYyk6dGhpcy4kZXZlbnRzW2FdPVt0aGlzLiRldmVudHNbYV0sY106dGhpcy4kZXZlbnRzW2FdPWM7cmV0dXJuIHRoaXN9LGMucHJvdG90eXBlLmFkZExpc3RlbmVyPWMucHJvdG90eXBlLm9uLGMucHJvdG90eXBlLm9uY2U9ZnVuY3Rpb24oYSxiKXtmdW5jdGlvbiBkKCl7Yy5yZW1vdmVMaXN0ZW5lcihhLGQpLGIuYXBwbHkodGhpcyxhcmd1bWVudHMpfXZhciBjPXRoaXM7ZC5saXN0ZW5lcj1iLHRoaXMub24oYSxkKTtyZXR1cm4gdGhpc30sYy5wcm90b3R5cGUucmVtb3ZlTGlzdGVuZXI9ZnVuY3Rpb24oYSxjKXtpZih0aGlzLiRldmVudHMmJnRoaXMuJGV2ZW50c1thXSl7dmFyIGQ9dGhpcy4kZXZlbnRzW2FdO2lmKGIudXRpbC5pc0FycmF5KGQpKXt2YXIgZT0tMTtmb3IodmFyIGY9MCxnPWQubGVuZ3RoO2Y8ZztmKyspaWYoZFtmXT09PWN8fGRbZl0ubGlzdGVuZXImJmRbZl0ubGlzdGVuZXI9PT1jKXtlPWY7YnJlYWt9aWYoZTwwKXJldHVybiB0aGlzO2Quc3BsaWNlKGUsMSksZC5sZW5ndGh8fGRlbGV0ZSB0aGlzLiRldmVudHNbYV19ZWxzZShkPT09Y3x8ZC5saXN0ZW5lciYmZC5saXN0ZW5lcj09PWMpJiZkZWxldGUgdGhpcy4kZXZlbnRzW2FdfXJldHVybiB0aGlzfSxjLnByb3RvdHlwZS5yZW1vdmVBbGxMaXN0ZW5lcnM9ZnVuY3Rpb24oYSl7dGhpcy4kZXZlbnRzJiZ0aGlzLiRldmVudHNbYV0mJih0aGlzLiRldmVudHNbYV09bnVsbCk7cmV0dXJuIHRoaXN9LGMucHJvdG90eXBlLmxpc3RlbmVycz1mdW5jdGlvbihhKXt0aGlzLiRldmVudHN8fCh0aGlzLiRldmVudHM9e30pLHRoaXMuJGV2ZW50c1thXXx8KHRoaXMuJGV2ZW50c1thXT1bXSksYi51dGlsLmlzQXJyYXkodGhpcy4kZXZlbnRzW2FdKXx8KHRoaXMuJGV2ZW50c1thXT1bdGhpcy4kZXZlbnRzW2FdXSk7cmV0dXJuIHRoaXMuJGV2ZW50c1thXX0sYy5wcm90b3R5cGUuZW1pdD1mdW5jdGlvbihhKXtpZighdGhpcy4kZXZlbnRzKXJldHVybiExO3ZhciBjPXRoaXMuJGV2ZW50c1thXTtpZighYylyZXR1cm4hMTt2YXIgZD1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMSk7aWYoImZ1bmN0aW9uIj09dHlwZW9mIGMpYy5hcHBseSh0aGlzLGQpO2Vsc2V7aWYoIWIudXRpbC5pc0FycmF5KGMpKXJldHVybiExO3ZhciBlPWMuc2xpY2UoKTtmb3IodmFyIGY9MCxnPWUubGVuZ3RoO2Y8ZztmKyspZVtmXS5hcHBseSh0aGlzLGQpfXJldHVybiEwfX0oInVuZGVmaW5lZCIhPXR5cGVvZiBpbz9pbzptb2R1bGUuZXhwb3J0cywidW5kZWZpbmVkIiE9dHlwZW9mIGlvP2lvOm1vZHVsZS5wYXJlbnQuZXhwb3J0cyksZnVuY3Rpb24oZXhwb3J0cyxuYXRpdmVKU09OKXtmdW5jdGlvbiBzdHIoYSxiKXt2YXIgYyxkLGUsZixnPWdhcCxoLGk9YlthXTtpIGluc3RhbmNlb2YgRGF0ZSYmKGk9ZGF0ZShhKSksdHlwZW9mIHJlcD09ImZ1bmN0aW9uIiYmKGk9cmVwLmNhbGwoYixhLGkpKTtzd2l0Y2godHlwZW9mIGkpe2Nhc2Uic3RyaW5nIjpyZXR1cm4gcXVvdGUoaSk7Y2FzZSJudW1iZXIiOnJldHVybiBpc0Zpbml0ZShpKT9TdHJpbmcoaSk6Im51bGwiO2Nhc2UiYm9vbGVhbiI6Y2FzZSJudWxsIjpyZXR1cm4gU3RyaW5nKGkpO2Nhc2Uib2JqZWN0IjppZighaSlyZXR1cm4ibnVsbCI7Z2FwKz1pbmRlbnQsaD1bXTtpZihPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmFwcGx5KGkpPT09IltvYmplY3QgQXJyYXldIil7Zj1pLmxlbmd0aDtmb3IoYz0wO2M8ZjtjKz0xKWhbY109c3RyKGMsaSl8fCJudWxsIjtlPWgubGVuZ3RoPT09MD8iW10iOmdhcD8iW1xuIitnYXAraC5qb2luKCIsXG4iK2dhcCkrIlxuIitnKyJdIjoiWyIraC5qb2luKCIsIikrIl0iLGdhcD1nO3JldHVybiBlfWlmKHJlcCYmdHlwZW9mIHJlcD09Im9iamVjdCIpe2Y9cmVwLmxlbmd0aDtmb3IoYz0wO2M8ZjtjKz0xKXR5cGVvZiByZXBbY109PSJzdHJpbmciJiYoZD1yZXBbY10sZT1zdHIoZCxpKSxlJiZoLnB1c2gocXVvdGUoZCkrKGdhcD8iOiAiOiI6IikrZSkpfWVsc2UgZm9yKGQgaW4gaSlPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoaSxkKSYmKGU9c3RyKGQsaSksZSYmaC5wdXNoKHF1b3RlKGQpKyhnYXA/IjogIjoiOiIpK2UpKTtlPWgubGVuZ3RoPT09MD8ie30iOmdhcD8ie1xuIitnYXAraC5qb2luKCIsXG4iK2dhcCkrIlxuIitnKyJ9IjoieyIraC5qb2luKCIsIikrIn0iLGdhcD1nO3JldHVybiBlfX1mdW5jdGlvbiBxdW90ZShhKXtlc2NhcGFibGUubGFzdEluZGV4PTA7cmV0dXJuIGVzY2FwYWJsZS50ZXN0KGEpPyciJythLnJlcGxhY2UoZXNjYXBhYmxlLGZ1bmN0aW9uKGEpe3ZhciBiPW1ldGFbYV07cmV0dXJuIHR5cGVvZiBiPT0ic3RyaW5nIj9iOiJcXHUiKygiMDAwMCIrYS5jaGFyQ29kZUF0KDApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTQpfSkrJyInOiciJythKyciJ31mdW5jdGlvbiBkYXRlKGEsYil7cmV0dXJuIGlzRmluaXRlKGEudmFsdWVPZigpKT9hLmdldFVUQ0Z1bGxZZWFyKCkrIi0iK2YoYS5nZXRVVENNb250aCgpKzEpKyItIitmKGEuZ2V0VVRDRGF0ZSgpKSsiVCIrZihhLmdldFVUQ0hvdXJzKCkpKyI6IitmKGEuZ2V0VVRDTWludXRlcygpKSsiOiIrZihhLmdldFVUQ1NlY29uZHMoKSkrIloiOm51bGx9ZnVuY3Rpb24gZihhKXtyZXR1cm4gYTwxMD8iMCIrYTphfSJ1c2Ugc3RyaWN0IjtpZihuYXRpdmVKU09OJiZuYXRpdmVKU09OLnBhcnNlKXJldHVybiBleHBvcnRzLkpTT049e3BhcnNlOm5hdGl2ZUpTT04ucGFyc2Usc3RyaW5naWZ5Om5hdGl2ZUpTT04uc3RyaW5naWZ5fTt2YXIgSlNPTj1leHBvcnRzLkpTT049e30sY3g9L1tcdTAwMDBcdTAwYWRcdTA2MDAtXHUwNjA0XHUwNzBmXHUxN2I0XHUxN2I1XHUyMDBjLVx1MjAwZlx1MjAyOC1cdTIwMmZcdTIwNjAtXHUyMDZmXHVmZWZmXHVmZmYwLVx1ZmZmZl0vZyxlc2NhcGFibGU9L1tcXFwiXHgwMC1ceDFmXHg3Zi1ceDlmXHUwMGFkXHUwNjAwLVx1MDYwNFx1MDcwZlx1MTdiNFx1MTdiNVx1MjAwYy1cdTIwMGZcdTIwMjgtXHUyMDJmXHUyMDYwLVx1MjA2Zlx1ZmVmZlx1ZmZmMC1cdWZmZmZdL2csZ2FwLGluZGVudCxtZXRhPXsiXGIiOiJcXGIiLCJcdCI6IlxcdCIsIlxuIjoiXFxuIiwiXGYiOiJcXGYiLCJcciI6IlxcciIsJyInOidcXCInLCJcXCI6IlxcXFwifSxyZXA7SlNPTi5zdHJpbmdpZnk9ZnVuY3Rpb24oYSxiLGMpe3ZhciBkO2dhcD0iIixpbmRlbnQ9IiI7aWYodHlwZW9mIGM9PSJudW1iZXIiKWZvcihkPTA7ZDxjO2QrPTEpaW5kZW50Kz0iICI7ZWxzZSB0eXBlb2YgYz09InN0cmluZyImJihpbmRlbnQ9Yyk7cmVwPWI7aWYoIWJ8fHR5cGVvZiBiPT0iZnVuY3Rpb24ifHx0eXBlb2YgYj09Im9iamVjdCImJnR5cGVvZiBiLmxlbmd0aD09Im51bWJlciIpcmV0dXJuIHN0cigiIix7IiI6YX0pO3Rocm93IG5ldyBFcnJvcigiSlNPTi5zdHJpbmdpZnkiKX0sSlNPTi5wYXJzZT1mdW5jdGlvbih0ZXh0LHJldml2ZXIpe2Z1bmN0aW9uIHdhbGsoYSxiKXt2YXIgYyxkLGU9YVtiXTtpZihlJiZ0eXBlb2YgZT09Im9iamVjdCIpZm9yKGMgaW4gZSlPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSxjKSYmKGQ9d2FsayhlLGMpLGQhPT11bmRlZmluZWQ/ZVtjXT1kOmRlbGV0ZSBlW2NdKTtyZXR1cm4gcmV2aXZlci5jYWxsKGEsYixlKX12YXIgajt0ZXh0PVN0cmluZyh0ZXh0KSxjeC5sYXN0SW5kZXg9MCxjeC50ZXN0KHRleHQpJiYodGV4dD10ZXh0LnJlcGxhY2UoY3gsZnVuY3Rpb24oYSl7cmV0dXJuIlxcdSIrKCIwMDAwIithLmNoYXJDb2RlQXQoMCkudG9TdHJpbmcoMTYpKS5zbGljZSgtNCl9KSk7aWYoL15bXF0sOnt9XHNdKiQvLnRlc3QodGV4dC5yZXBsYWNlKC9cXCg/OlsiXFxcL2JmbnJ0XXx1WzAtOWEtZkEtRl17NH0pL2csIkAiKS5yZXBsYWNlKC8iW14iXFxcblxyXSoifHRydWV8ZmFsc2V8bnVsbHwtP1xkKyg/OlwuXGQqKT8oPzpbZUVdWytcLV0/XGQrKT8vZywiXSIpLnJlcGxhY2UoLyg/Ol58OnwsKSg/OlxzKlxbKSsvZywiIikpKXtqPWV2YWwoIigiK3RleHQrIikiKTtyZXR1cm4gdHlwZW9mIHJldml2ZXI9PSJmdW5jdGlvbiI/d2Fsayh7IiI6an0sIiIpOmp9dGhyb3cgbmV3IFN5bnRheEVycm9yKCJKU09OLnBhcnNlIil9fSgidW5kZWZpbmVkIiE9dHlwZW9mIGlvP2lvOm1vZHVsZS5leHBvcnRzLHR5cGVvZiBKU09OIT0idW5kZWZpbmVkIj9KU09OOnVuZGVmaW5lZCksZnVuY3Rpb24oYSxiKXt2YXIgYz1hLnBhcnNlcj17fSxkPWMucGFja2V0cz1bImRpc2Nvbm5lY3QiLCJjb25uZWN0IiwiaGVhcnRiZWF0IiwibWVzc2FnZSIsImpzb24iLCJldmVudCIsImFjayIsImVycm9yIiwibm9vcCJdLGU9Yy5yZWFzb25zPVsidHJhbnNwb3J0IG5vdCBzdXBwb3J0ZWQiLCJjbGllbnQgbm90IGhhbmRzaGFrZW4iLCJ1bmF1dGhvcml6ZWQiXSxmPWMuYWR2aWNlPVsicmVjb25uZWN0Il0sZz1iLkpTT04saD1iLnV0aWwuaW5kZXhPZjtjLmVuY29kZVBhY2tldD1mdW5jdGlvbihhKXt2YXIgYj1oKGQsYS50eXBlKSxjPWEuaWR8fCIiLGk9YS5lbmRwb2ludHx8IiIsaj1hLmFjayxrPW51bGw7c3dpdGNoKGEudHlwZSl7Y2FzZSJlcnJvciI6dmFyIGw9YS5yZWFzb24/aChlLGEucmVhc29uKToiIixtPWEuYWR2aWNlP2goZixhLmFkdmljZSk6IiI7aWYobCE9PSIifHxtIT09IiIpaz1sKyhtIT09IiI/IisiK206IiIpO2JyZWFrO2Nhc2UibWVzc2FnZSI6YS5kYXRhIT09IiImJihrPWEuZGF0YSk7YnJlYWs7Y2FzZSJldmVudCI6dmFyIG49e25hbWU6YS5uYW1lfTthLmFyZ3MmJmEuYXJncy5sZW5ndGgmJihuLmFyZ3M9YS5hcmdzKSxrPWcuc3RyaW5naWZ5KG4pO2JyZWFrO2Nhc2UianNvbiI6az1nLnN0cmluZ2lmeShhLmRhdGEpO2JyZWFrO2Nhc2UiY29ubmVjdCI6YS5xcyYmKGs9YS5xcyk7YnJlYWs7Y2FzZSJhY2siOms9YS5hY2tJZCsoYS5hcmdzJiZhLmFyZ3MubGVuZ3RoPyIrIitnLnN0cmluZ2lmeShhLmFyZ3MpOiIiKX12YXIgbz1bYixjKyhqPT0iZGF0YSI/IisiOiIiKSxpXTtrIT09bnVsbCYmayE9PXVuZGVmaW5lZCYmby5wdXNoKGspO3JldHVybiBvLmpvaW4oIjoiKX0sYy5lbmNvZGVQYXlsb2FkPWZ1bmN0aW9uKGEpe3ZhciBiPSIiO2lmKGEubGVuZ3RoPT0xKXJldHVybiBhWzBdO2Zvcih2YXIgYz0wLGQ9YS5sZW5ndGg7YzxkO2MrKyl7dmFyIGU9YVtjXTtiKz0iXHVmZmZkIitlLmxlbmd0aCsiXHVmZmZkIithW2NdfXJldHVybiBifTt2YXIgaT0vKFteOl0rKTooWzAtOV0rKT8oXCspPzooW146XSspPzo/KFtcc1xTXSopPy87Yy5kZWNvZGVQYWNrZXQ9ZnVuY3Rpb24oYSl7dmFyIGI9YS5tYXRjaChpKTtpZighYilyZXR1cm57fTt2YXIgYz1iWzJdfHwiIixhPWJbNV18fCIiLGg9e3R5cGU6ZFtiWzFdXSxlbmRwb2ludDpiWzRdfHwiIn07YyYmKGguaWQ9YyxiWzNdP2guYWNrPSJkYXRhIjpoLmFjaz0hMCk7c3dpdGNoKGgudHlwZSl7Y2FzZSJlcnJvciI6dmFyIGI9YS5zcGxpdCgiKyIpO2gucmVhc29uPWVbYlswXV18fCIiLGguYWR2aWNlPWZbYlsxXV18fCIiO2JyZWFrO2Nhc2UibWVzc2FnZSI6aC5kYXRhPWF8fCIiO2JyZWFrO2Nhc2UiZXZlbnQiOnRyeXt2YXIgaj1nLnBhcnNlKGEpO2gubmFtZT1qLm5hbWUsaC5hcmdzPWouYXJnc31jYXRjaChrKXt9aC5hcmdzPWguYXJnc3x8W107YnJlYWs7Y2FzZSJqc29uIjp0cnl7aC5kYXRhPWcucGFyc2UoYSl9Y2F0Y2goayl7fWJyZWFrO2Nhc2UiY29ubmVjdCI6aC5xcz1hfHwiIjticmVhaztjYXNlImFjayI6dmFyIGI9YS5tYXRjaCgvXihbMC05XSspKFwrKT8oLiopLyk7aWYoYil7aC5hY2tJZD1iWzFdLGguYXJncz1bXTtpZihiWzNdKXRyeXtoLmFyZ3M9YlszXT9nLnBhcnNlKGJbM10pOltdfWNhdGNoKGspe319YnJlYWs7Y2FzZSJkaXNjb25uZWN0IjpjYXNlImhlYXJ0YmVhdCI6fXJldHVybiBofSxjLmRlY29kZVBheWxvYWQ9ZnVuY3Rpb24oYSl7aWYoYS5jaGFyQXQoMCk9PSJcdWZmZmQiKXt2YXIgYj1bXTtmb3IodmFyIGQ9MSxlPSIiO2Q8YS5sZW5ndGg7ZCsrKWEuY2hhckF0KGQpPT0iXHVmZmZkIj8oYi5wdXNoKGMuZGVjb2RlUGFja2V0KGEuc3Vic3RyKGQrMSkuc3Vic3RyKDAsZSkpKSxkKz1OdW1iZXIoZSkrMSxlPSIiKTplKz1hLmNoYXJBdChkKTtyZXR1cm4gYn1yZXR1cm5bYy5kZWNvZGVQYWNrZXQoYSldfX0oInVuZGVmaW5lZCIhPXR5cGVvZiBpbz9pbzptb2R1bGUuZXhwb3J0cywidW5kZWZpbmVkIiE9dHlwZW9mIGlvP2lvOm1vZHVsZS5wYXJlbnQuZXhwb3J0cyksZnVuY3Rpb24oYSxiKXtmdW5jdGlvbiBjKGEsYil7dGhpcy5zb2NrZXQ9YSx0aGlzLnNlc3NpZD1ifWEuVHJhbnNwb3J0PWMsYi51dGlsLm1peGluKGMsYi5FdmVudEVtaXR0ZXIpLGMucHJvdG90eXBlLm9uRGF0YT1mdW5jdGlvbihhKXt0aGlzLmNsZWFyQ2xvc2VUaW1lb3V0KCksKHRoaXMuY29ubmVjdGVkfHx0aGlzLmNvbm5lY3Rpbmd8fHRoaXMucmVjb25uZWN0aW5nKSYmdGhpcy5zZXRDbG9zZVRpbWVvdXQoKTtpZihhIT09IiIpe3ZhciBjPWIucGFyc2VyLmRlY29kZVBheWxvYWQoYSk7aWYoYyYmYy5sZW5ndGgpZm9yKHZhciBkPTAsZT1jLmxlbmd0aDtkPGU7ZCsrKXRoaXMub25QYWNrZXQoY1tkXSl9cmV0dXJuIHRoaXN9LGMucHJvdG90eXBlLm9uUGFja2V0PWZ1bmN0aW9uKGEpe2lmKGEudHlwZT09ImhlYXJ0YmVhdCIpcmV0dXJuIHRoaXMub25IZWFydGJlYXQoKTthLnR5cGU9PSJjb25uZWN0IiYmYS5lbmRwb2ludD09IiImJnRoaXMub25Db25uZWN0KCksdGhpcy5zb2NrZXQub25QYWNrZXQoYSk7cmV0dXJuIHRoaXN9LGMucHJvdG90eXBlLnNldENsb3NlVGltZW91dD1mdW5jdGlvbigpe2lmKCF0aGlzLmNsb3NlVGltZW91dCl7dmFyIGE9dGhpczt0aGlzLmNsb3NlVGltZW91dD1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7YS5vbkRpc2Nvbm5lY3QoKX0sdGhpcy5zb2NrZXQuY2xvc2VUaW1lb3V0KX19LGMucHJvdG90eXBlLm9uRGlzY29ubmVjdD1mdW5jdGlvbigpe3RoaXMuY2xvc2UmJnRoaXMub3BlbiYmdGhpcy5jbG9zZSgpLHRoaXMuY2xlYXJUaW1lb3V0cygpLHRoaXMuc29ja2V0Lm9uRGlzY29ubmVjdCgpO3JldHVybiB0aGlzfSxjLnByb3RvdHlwZS5vbkNvbm5lY3Q9ZnVuY3Rpb24oKXt0aGlzLnNvY2tldC5vbkNvbm5lY3QoKTtyZXR1cm4gdGhpc30sYy5wcm90b3R5cGUuY2xlYXJDbG9zZVRpbWVvdXQ9ZnVuY3Rpb24oKXt0aGlzLmNsb3NlVGltZW91dCYmKGNsZWFyVGltZW91dCh0aGlzLmNsb3NlVGltZW91dCksdGhpcy5jbG9zZVRpbWVvdXQ9bnVsbCl9LGMucHJvdG90eXBlLmNsZWFyVGltZW91dHM9ZnVuY3Rpb24oKXt0aGlzLmNsZWFyQ2xvc2VUaW1lb3V0KCksdGhpcy5yZW9wZW5UaW1lb3V0JiZjbGVhclRpbWVvdXQodGhpcy5yZW9wZW5UaW1lb3V0KX0sYy5wcm90b3R5cGUucGFja2V0PWZ1bmN0aW9uKGEpe3RoaXMuc2VuZChiLnBhcnNlci5lbmNvZGVQYWNrZXQoYSkpfSxjLnByb3RvdHlwZS5vbkhlYXJ0YmVhdD1mdW5jdGlvbihhKXt0aGlzLnBhY2tldCh7dHlwZToiaGVhcnRiZWF0In0pfSxjLnByb3RvdHlwZS5vbk9wZW49ZnVuY3Rpb24oKXt0aGlzLm9wZW49ITAsdGhpcy5jbGVhckNsb3NlVGltZW91dCgpLHRoaXMuc29ja2V0Lm9uT3BlbigpfSxjLnByb3RvdHlwZS5vbkNsb3NlPWZ1bmN0aW9uKCl7dmFyIGE9dGhpczt0aGlzLm9wZW49ITEsdGhpcy5zb2NrZXQub25DbG9zZSgpLHRoaXMub25EaXNjb25uZWN0KCl9LGMucHJvdG90eXBlLnByZXBhcmVVcmw9ZnVuY3Rpb24oKXt2YXIgYT10aGlzLnNvY2tldC5vcHRpb25zO3JldHVybiB0aGlzLnNjaGVtZSgpKyI6Ly8iK2EuaG9zdCsiOiIrYS5wb3J0KyIvIithLnJlc291cmNlKyIvIitiLnByb3RvY29sKyIvIit0aGlzLm5hbWUrIi8iK3RoaXMuc2Vzc2lkfSxjLnByb3RvdHlwZS5yZWFkeT1mdW5jdGlvbihhLGIpe2IuY2FsbCh0aGlzKX19KCJ1bmRlZmluZWQiIT10eXBlb2YgaW8/aW86bW9kdWxlLmV4cG9ydHMsInVuZGVmaW5lZCIhPXR5cGVvZiBpbz9pbzptb2R1bGUucGFyZW50LmV4cG9ydHMpLGZ1bmN0aW9uKGEsYixjKXtmdW5jdGlvbiBlKCl7fWZ1bmN0aW9uIGQoYSl7dGhpcy5vcHRpb25zPXtwb3J0OjgwLHNlY3VyZTohMSxkb2N1bWVudDoiZG9jdW1lbnQiaW4gYz9kb2N1bWVudDohMSxyZXNvdXJjZToic29ja2V0LmlvIix0cmFuc3BvcnRzOmIudHJhbnNwb3J0cywiY29ubmVjdCB0aW1lb3V0IjoxZTQsInRyeSBtdWx0aXBsZSB0cmFuc3BvcnRzIjohMCxyZWNvbm5lY3Q6ITAsInJlY29ubmVjdGlvbiBkZWxheSI6NTAwLCJyZWNvbm5lY3Rpb24gbGltaXQiOkluZmluaXR5LCJyZW9wZW4gZGVsYXkiOjNlMywibWF4IHJlY29ubmVjdGlvbiBhdHRlbXB0cyI6MTAsInN5bmMgZGlzY29ubmVjdCBvbiB1bmxvYWQiOiEwLCJhdXRvIGNvbm5lY3QiOiEwLCJmbGFzaCBwb2xpY3kgcG9ydCI6MTA4NDN9LGIudXRpbC5tZXJnZSh0aGlzLm9wdGlvbnMsYSksdGhpcy5jb25uZWN0ZWQ9ITEsdGhpcy5vcGVuPSExLHRoaXMuY29ubmVjdGluZz0hMSx0aGlzLnJlY29ubmVjdGluZz0hMSx0aGlzLm5hbWVzcGFjZXM9e30sdGhpcy5idWZmZXI9W10sdGhpcy5kb0J1ZmZlcj0hMTtpZih0aGlzLm9wdGlvbnNbInN5bmMgZGlzY29ubmVjdCBvbiB1bmxvYWQiXSYmKCF0aGlzLmlzWERvbWFpbigpfHxiLnV0aWwudWEuaGFzQ09SUykpe3ZhciBkPXRoaXM7Yi51dGlsLm9uKGMsImJlZm9yZXVubG9hZCIsZnVuY3Rpb24oKXtkLmRpc2Nvbm5lY3RTeW5jKCl9LCExKX10aGlzLm9wdGlvbnNbImF1dG8gY29ubmVjdCJdJiZ0aGlzLmNvbm5lY3QoKX1hLlNvY2tldD1kLGIudXRpbC5taXhpbihkLGIuRXZlbnRFbWl0dGVyKSxkLnByb3RvdHlwZS5vZj1mdW5jdGlvbihhKXt0aGlzLm5hbWVzcGFjZXNbYV18fCh0aGlzLm5hbWVzcGFjZXNbYV09bmV3IGIuU29ja2V0TmFtZXNwYWNlKHRoaXMsYSksYSE9PSIiJiZ0aGlzLm5hbWVzcGFjZXNbYV0ucGFja2V0KHt0eXBlOiJjb25uZWN0In0pKTtyZXR1cm4gdGhpcy5uYW1lc3BhY2VzW2FdfSxkLnByb3RvdHlwZS5wdWJsaXNoPWZ1bmN0aW9uKCl7dGhpcy5lbWl0LmFwcGx5KHRoaXMsYXJndW1lbnRzKTt2YXIgYTtmb3IodmFyIGIgaW4gdGhpcy5uYW1lc3BhY2VzKXRoaXMubmFtZXNwYWNlcy5oYXNPd25Qcm9wZXJ0eShiKSYmKGE9dGhpcy5vZihiKSxhLiRlbWl0LmFwcGx5KGEsYXJndW1lbnRzKSl9LGQucHJvdG90eXBlLmhhbmRzaGFrZT1mdW5jdGlvbihhKXtmdW5jdGlvbiBmKGIpe2IgaW5zdGFuY2VvZiBFcnJvcj9jLm9uRXJyb3IoYi5tZXNzYWdlKTphLmFwcGx5KG51bGwsYi5zcGxpdCgiOiIpKX12YXIgYz10aGlzLGQ9dGhpcy5vcHRpb25zLGc9WyJodHRwIisoZC5zZWN1cmU/InMiOiIiKSsiOi8iLGQuaG9zdCsiOiIrZC5wb3J0LGQucmVzb3VyY2UsYi5wcm90b2NvbCxiLnV0aWwucXVlcnkodGhpcy5vcHRpb25zLnF1ZXJ5LCJ0PSIrICsobmV3IERhdGUpKV0uam9pbigiLyIpO2lmKHRoaXMuaXNYRG9tYWluKCkmJiFiLnV0aWwudWEuaGFzQ09SUyl7dmFyIGg9ZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInNjcmlwdCIpWzBdLGk9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7aS5zcmM9ZysiJmpzb25wPSIrYi5qLmxlbmd0aCxoLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGksaCksYi5qLnB1c2goZnVuY3Rpb24oYSl7ZihhKSxpLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoaSl9KX1lbHNle3ZhciBqPWIudXRpbC5yZXF1ZXN0KCk7ai5vcGVuKCJHRVQiLGcsITApLGoub25yZWFkeXN0YXRlY2hhbmdlPWZ1bmN0aW9uKCl7ai5yZWFkeVN0YXRlPT00JiYoai5vbnJlYWR5c3RhdGVjaGFuZ2U9ZSxqLnN0YXR1cz09MjAwP2Yoai5yZXNwb25zZVRleHQpOiFjLnJlY29ubmVjdGluZyYmYy5vbkVycm9yKGoucmVzcG9uc2VUZXh0KSl9LGouc2VuZChudWxsKX19LGQucHJvdG90eXBlLmdldFRyYW5zcG9ydD1mdW5jdGlvbihhKXt2YXIgYz1hfHx0aGlzLnRyYW5zcG9ydHMsZDtmb3IodmFyIGU9MCxmO2Y9Y1tlXTtlKyspaWYoYi5UcmFuc3BvcnRbZl0mJmIuVHJhbnNwb3J0W2ZdLmNoZWNrKHRoaXMpJiYoIXRoaXMuaXNYRG9tYWluKCl8fGIuVHJhbnNwb3J0W2ZdLnhkb21haW5DaGVjaygpKSlyZXR1cm4gbmV3IGIuVHJhbnNwb3J0W2ZdKHRoaXMsdGhpcy5zZXNzaW9uaWQpO3JldHVybiBudWxsfSxkLnByb3RvdHlwZS5jb25uZWN0PWZ1bmN0aW9uKGEpe2lmKHRoaXMuY29ubmVjdGluZylyZXR1cm4gdGhpczt2YXIgYz10aGlzO3RoaXMuaGFuZHNoYWtlKGZ1bmN0aW9uKGQsZSxmLGcpe2Z1bmN0aW9uIGgoYSl7Yy50cmFuc3BvcnQmJmMudHJhbnNwb3J0LmNsZWFyVGltZW91dHMoKSxjLnRyYW5zcG9ydD1jLmdldFRyYW5zcG9ydChhKTtpZighYy50cmFuc3BvcnQpcmV0dXJuIGMucHVibGlzaCgiY29ubmVjdF9mYWlsZWQiKTtjLnRyYW5zcG9ydC5yZWFkeShjLGZ1bmN0aW9uKCl7Yy5jb25uZWN0aW5nPSEwLGMucHVibGlzaCgiY29ubmVjdGluZyIsYy50cmFuc3BvcnQubmFtZSksYy50cmFuc3BvcnQub3BlbigpLGMub3B0aW9uc1siY29ubmVjdCB0aW1lb3V0Il0mJihjLmNvbm5lY3RUaW1lb3V0VGltZXI9c2V0VGltZW91dChmdW5jdGlvbigpe2lmKCFjLmNvbm5lY3RlZCl7Yy5jb25uZWN0aW5nPSExO2lmKGMub3B0aW9uc1sidHJ5IG11bHRpcGxlIHRyYW5zcG9ydHMiXSl7Yy5yZW1haW5pbmdUcmFuc3BvcnRzfHwoYy5yZW1haW5pbmdUcmFuc3BvcnRzPWMudHJhbnNwb3J0cy5zbGljZSgwKSk7dmFyIGE9Yy5yZW1haW5pbmdUcmFuc3BvcnRzO3doaWxlKGEubGVuZ3RoPjAmJmEuc3BsaWNlKDAsMSlbMF0hPWMudHJhbnNwb3J0Lm5hbWUpO2EubGVuZ3RoP2goYSk6Yy5wdWJsaXNoKCJjb25uZWN0X2ZhaWxlZCIpfX19LGMub3B0aW9uc1siY29ubmVjdCB0aW1lb3V0Il0pKX0pfWMuc2Vzc2lvbmlkPWQsYy5jbG9zZVRpbWVvdXQ9ZioxZTMsYy5oZWFydGJlYXRUaW1lb3V0PWUqMWUzLGMudHJhbnNwb3J0cz1iLnV0aWwuaW50ZXJzZWN0KGcuc3BsaXQoIiwiKSxjLm9wdGlvbnMudHJhbnNwb3J0cyksaCgpLGMub25jZSgiY29ubmVjdCIsZnVuY3Rpb24oKXtjbGVhclRpbWVvdXQoYy5jb25uZWN0VGltZW91dFRpbWVyKSxhJiZ0eXBlb2YgYT09ImZ1bmN0aW9uIiYmYSgpfSl9KTtyZXR1cm4gdGhpc30sZC5wcm90b3R5cGUucGFja2V0PWZ1bmN0aW9uKGEpe3RoaXMuY29ubmVjdGVkJiYhdGhpcy5kb0J1ZmZlcj90aGlzLnRyYW5zcG9ydC5wYWNrZXQoYSk6dGhpcy5idWZmZXIucHVzaChhKTtyZXR1cm4gdGhpc30sZC5wcm90b3R5cGUuc2V0QnVmZmVyPWZ1bmN0aW9uKGEpe3RoaXMuZG9CdWZmZXI9YSwhYSYmdGhpcy5jb25uZWN0ZWQmJnRoaXMuYnVmZmVyLmxlbmd0aCYmKHRoaXMudHJhbnNwb3J0LnBheWxvYWQodGhpcy5idWZmZXIpLHRoaXMuYnVmZmVyPVtdKX0sZC5wcm90b3R5cGUuZGlzY29ubmVjdD1mdW5jdGlvbigpe3RoaXMuY29ubmVjdGVkJiYodGhpcy5vcGVuJiZ0aGlzLm9mKCIiKS5wYWNrZXQoe3R5cGU6ImRpc2Nvbm5lY3QifSksdGhpcy5vbkRpc2Nvbm5lY3QoImJvb3RlZCIpKTtyZXR1cm4gdGhpc30sZC5wcm90b3R5cGUuZGlzY29ubmVjdFN5bmM9ZnVuY3Rpb24oKXt2YXIgYT1iLnV0aWwucmVxdWVzdCgpLGM9dGhpcy5yZXNvdXJjZSsiLyIrYi5wcm90b2NvbCsiLyIrdGhpcy5zZXNzaW9uaWQ7YS5vcGVuKCJHRVQiLGMsITApLHRoaXMub25EaXNjb25uZWN0KCJib290ZWQiKX0sZC5wcm90b3R5cGUuaXNYRG9tYWluPWZ1bmN0aW9uKCl7dmFyIGE9Yy5sb2NhdGlvbi5wb3J0fHwoImh0dHBzOiI9PWMubG9jYXRpb24ucHJvdG9jb2w/NDQzOjgwKTtyZXR1cm4gdGhpcy5vcHRpb25zLmhvc3QhPT1jLmxvY2F0aW9uLmhvc3RuYW1lfHx0aGlzLm9wdGlvbnMucG9ydCE9YX0sZC5wcm90b3R5cGUub25Db25uZWN0PWZ1bmN0aW9uKCl7dGhpcy5jb25uZWN0ZWR8fCh0aGlzLmNvbm5lY3RlZD0hMCx0aGlzLmNvbm5lY3Rpbmc9ITEsdGhpcy5kb0J1ZmZlcnx8dGhpcy5zZXRCdWZmZXIoITEpLHRoaXMuZW1pdCgiY29ubmVjdCIpKX0sZC5wcm90b3R5cGUub25PcGVuPWZ1bmN0aW9uKCl7dGhpcy5vcGVuPSEwfSxkLnByb3RvdHlwZS5vbkNsb3NlPWZ1bmN0aW9uKCl7dGhpcy5vcGVuPSExfSxkLnByb3RvdHlwZS5vblBhY2tldD1mdW5jdGlvbihhKXt0aGlzLm9mKGEuZW5kcG9pbnQpLm9uUGFja2V0KGEpfSxkLnByb3RvdHlwZS5vbkVycm9yPWZ1bmN0aW9uKGEpe2EmJmEuYWR2aWNlJiZhLmFkdmljZT09PSJyZWNvbm5lY3QiJiZ0aGlzLmNvbm5lY3RlZCYmKHRoaXMuZGlzY29ubmVjdCgpLHRoaXMucmVjb25uZWN0KCkpLHRoaXMucHVibGlzaCgiZXJyb3IiLGEmJmEucmVhc29uP2EucmVhc29uOmEpfSxkLnByb3RvdHlwZS5vbkRpc2Nvbm5lY3Q9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5jb25uZWN0ZWQ7dGhpcy5jb25uZWN0ZWQ9ITEsdGhpcy5jb25uZWN0aW5nPSExLHRoaXMub3Blbj0hMSxiJiYodGhpcy50cmFuc3BvcnQuY2xvc2UoKSx0aGlzLnRyYW5zcG9ydC5jbGVhclRpbWVvdXRzKCksdGhpcy5wdWJsaXNoKCJkaXNjb25uZWN0IixhKSwiYm9vdGVkIiE9YSYmdGhpcy5vcHRpb25zLnJlY29ubmVjdCYmIXRoaXMucmVjb25uZWN0aW5nJiZ0aGlzLnJlY29ubmVjdCgpKX0sZC5wcm90b3R5cGUucmVjb25uZWN0PWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZigpe2lmKCEhYS5yZWNvbm5lY3Rpbmcpe2lmKGEuY29ubmVjdGVkKXJldHVybiBlKCk7aWYoYS5jb25uZWN0aW5nJiZhLnJlY29ubmVjdGluZylyZXR1cm4gYS5yZWNvbm5lY3Rpb25UaW1lcj1zZXRUaW1lb3V0KGYsMWUzKTthLnJlY29ubmVjdGlvbkF0dGVtcHRzKys+PWI/YS5yZWRvVHJhbnNwb3J0cz8oYS5wdWJsaXNoKCJyZWNvbm5lY3RfZmFpbGVkIiksZSgpKTooYS5vbigiY29ubmVjdF9mYWlsZWQiLGYpLGEub3B0aW9uc1sidHJ5IG11bHRpcGxlIHRyYW5zcG9ydHMiXT0hMCxhLnRyYW5zcG9ydD1hLmdldFRyYW5zcG9ydCgpLGEucmVkb1RyYW5zcG9ydHM9ITAsYS5jb25uZWN0KCkpOihhLnJlY29ubmVjdGlvbkRlbGF5PGQmJihhLnJlY29ubmVjdGlvbkRlbGF5Kj0yKSxhLmNvbm5lY3QoKSxhLnB1Ymxpc2goInJlY29ubmVjdGluZyIsYS5yZWNvbm5lY3Rpb25EZWxheSxhLnJlY29ubmVjdGlvbkF0dGVtcHRzKSxhLnJlY29ubmVjdGlvblRpbWVyPXNldFRpbWVvdXQoZixhLnJlY29ubmVjdGlvbkRlbGF5KSl9fWZ1bmN0aW9uIGUoKXtpZihhLmNvbm5lY3RlZCl7Zm9yKHZhciBiIGluIGEubmFtZXNwYWNlcylhLm5hbWVzcGFjZXMuaGFzT3duUHJvcGVydHkoYikmJiIiIT09YiYmYS5uYW1lc3BhY2VzW2JdLnBhY2tldCh7dHlwZToiY29ubmVjdCJ9KTthLnB1Ymxpc2goInJlY29ubmVjdCIsYS50cmFuc3BvcnQubmFtZSxhLnJlY29ubmVjdGlvbkF0dGVtcHRzKX1hLnJlbW92ZUxpc3RlbmVyKCJjb25uZWN0X2ZhaWxlZCIsZiksYS5yZW1vdmVMaXN0ZW5lcigiY29ubmVjdCIsZiksYS5yZWNvbm5lY3Rpbmc9ITEsZGVsZXRlIGEucmVjb25uZWN0aW9uQXR0ZW1wdHMsZGVsZXRlIGEucmVjb25uZWN0aW9uRGVsYXksZGVsZXRlIGEucmVjb25uZWN0aW9uVGltZXIsZGVsZXRlIGEucmVkb1RyYW5zcG9ydHMsYS5vcHRpb25zWyJ0cnkgbXVsdGlwbGUgdHJhbnNwb3J0cyJdPWN9dGhpcy5yZWNvbm5lY3Rpbmc9ITAsdGhpcy5yZWNvbm5lY3Rpb25BdHRlbXB0cz0wLHRoaXMucmVjb25uZWN0aW9uRGVsYXk9dGhpcy5vcHRpb25zWyJyZWNvbm5lY3Rpb24gZGVsYXkiXTt2YXIgYT10aGlzLGI9dGhpcy5vcHRpb25zWyJtYXggcmVjb25uZWN0aW9uIGF0dGVtcHRzIl0sYz10aGlzLm9wdGlvbnNbInRyeSBtdWx0aXBsZSB0cmFuc3BvcnRzIl0sZD10aGlzLm9wdGlvbnNbInJlY29ubmVjdGlvbiBsaW1pdCJdO3RoaXMub3B0aW9uc1sidHJ5IG11bHRpcGxlIHRyYW5zcG9ydHMiXT0hMSx0aGlzLnJlY29ubmVjdGlvblRpbWVyPXNldFRpbWVvdXQoZix0aGlzLnJlY29ubmVjdGlvbkRlbGF5KSx0aGlzLm9uKCJjb25uZWN0IixmKX19KCJ1bmRlZmluZWQiIT10eXBlb2YgaW8/aW86bW9kdWxlLmV4cG9ydHMsInVuZGVmaW5lZCIhPXR5cGVvZiBpbz9pbzptb2R1bGUucGFyZW50LmV4cG9ydHMsdGhpcyksZnVuY3Rpb24oYSxiKXtmdW5jdGlvbiBkKGEsYil7dGhpcy5uYW1lc3BhY2U9YSx0aGlzLm5hbWU9Yn1mdW5jdGlvbiBjKGEsYil7dGhpcy5zb2NrZXQ9YSx0aGlzLm5hbWU9Ynx8IiIsdGhpcy5mbGFncz17fSx0aGlzLmpzb249bmV3IGQodGhpcywianNvbiIpLHRoaXMuYWNrUGFja2V0cz0wLHRoaXMuYWNrcz17fX1hLlNvY2tldE5hbWVzcGFjZT1jLGIudXRpbC5taXhpbihjLGIuRXZlbnRFbWl0dGVyKSxjLnByb3RvdHlwZS4kZW1pdD1iLkV2ZW50RW1pdHRlci5wcm90b3R5cGUuZW1pdCxjLnByb3RvdHlwZS5vZj1mdW5jdGlvbigpe3JldHVybiB0aGlzLnNvY2tldC5vZi5hcHBseSh0aGlzLnNvY2tldCxhcmd1bWVudHMpfSxjLnByb3RvdHlwZS5wYWNrZXQ9ZnVuY3Rpb24oYSl7YS5lbmRwb2ludD10aGlzLm5hbWUsdGhpcy5zb2NrZXQucGFja2V0KGEpLHRoaXMuZmxhZ3M9e307cmV0dXJuIHRoaXN9LGMucHJvdG90eXBlLnNlbmQ9ZnVuY3Rpb24oYSxiKXt2YXIgYz17dHlwZTp0aGlzLmZsYWdzLmpzb24/Impzb24iOiJtZXNzYWdlIixkYXRhOmF9OyJmdW5jdGlvbiI9PXR5cGVvZiBiJiYoYy5pZD0rK3RoaXMuYWNrUGFja2V0cyxjLmFjaz0hMCx0aGlzLmFja3NbYy5pZF09Yik7cmV0dXJuIHRoaXMucGFja2V0KGMpfSxjLnByb3RvdHlwZS5lbWl0PWZ1bmN0aW9uKGEpe3ZhciBiPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywxKSxjPWJbYi5sZW5ndGgtMV0sZD17dHlwZToiZXZlbnQiLG5hbWU6YX07ImZ1bmN0aW9uIj09dHlwZW9mIGMmJihkLmlkPSsrdGhpcy5hY2tQYWNrZXRzLGQuYWNrPSJkYXRhIix0aGlzLmFja3NbZC5pZF09YyxiPWIuc2xpY2UoMCxiLmxlbmd0aC0xKSksZC5hcmdzPWI7cmV0dXJuIHRoaXMucGFja2V0KGQpfSxjLnByb3RvdHlwZS5kaXNjb25uZWN0PWZ1bmN0aW9uKCl7dGhpcy5uYW1lPT09IiI/dGhpcy5zb2NrZXQuZGlzY29ubmVjdCgpOih0aGlzLnBhY2tldCh7dHlwZToiZGlzY29ubmVjdCJ9KSx0aGlzLiRlbWl0KCJkaXNjb25uZWN0IikpO3JldHVybiB0aGlzfSxjLnByb3RvdHlwZS5vblBhY2tldD1mdW5jdGlvbihhKXtmdW5jdGlvbiBkKCl7Yy5wYWNrZXQoe3R5cGU6ImFjayIsYXJnczpiLnV0aWwudG9BcnJheShhcmd1bWVudHMpLGFja0lkOmEuaWR9KX12YXIgYz10aGlzO3N3aXRjaChhLnR5cGUpe2Nhc2UiY29ubmVjdCI6dGhpcy4kZW1pdCgiY29ubmVjdCIpO2JyZWFrO2Nhc2UiZGlzY29ubmVjdCI6dGhpcy5uYW1lPT09IiI/dGhpcy5zb2NrZXQub25EaXNjb25uZWN0KGEucmVhc29ufHwiYm9vdGVkIik6dGhpcy4kZW1pdCgiZGlzY29ubmVjdCIsYS5yZWFzb24pO2JyZWFrO2Nhc2UibWVzc2FnZSI6Y2FzZSJqc29uIjp2YXIgZT1bIm1lc3NhZ2UiLGEuZGF0YV07YS5hY2s9PSJkYXRhIj9lLnB1c2goZCk6YS5hY2smJnRoaXMucGFja2V0KHt0eXBlOiJhY2siLGFja0lkOmEuaWR9KSx0aGlzLiRlbWl0LmFwcGx5KHRoaXMsZSk7YnJlYWs7Y2FzZSJldmVudCI6dmFyIGU9W2EubmFtZV0uY29uY2F0KGEuYXJncyk7YS5hY2s9PSJkYXRhIiYmZS5wdXNoKGQpLHRoaXMuJGVtaXQuYXBwbHkodGhpcyxlKTticmVhaztjYXNlImFjayI6dGhpcy5hY2tzW2EuYWNrSWRdJiYodGhpcy5hY2tzW2EuYWNrSWRdLmFwcGx5KHRoaXMsYS5hcmdzKSxkZWxldGUgdGhpcy5hY2tzW2EuYWNrSWRdKTticmVhaztjYXNlImVycm9yIjphLmFkdmljZT90aGlzLnNvY2tldC5vbkVycm9yKGEpOmEucmVhc29uPT0idW5hdXRob3JpemVkIj90aGlzLiRlbWl0KCJjb25uZWN0X2ZhaWxlZCIsYS5yZWFzb24pOnRoaXMuJGVtaXQoImVycm9yIixhLnJlYXNvbil9fSxkLnByb3RvdHlwZS5zZW5kPWZ1bmN0aW9uKCl7dGhpcy5uYW1lc3BhY2UuZmxhZ3NbdGhpcy5uYW1lXT0hMCx0aGlzLm5hbWVzcGFjZS5zZW5kLmFwcGx5KHRoaXMubmFtZXNwYWNlLGFyZ3VtZW50cyl9LGQucHJvdG90eXBlLmVtaXQ9ZnVuY3Rpb24oKXt0aGlzLm5hbWVzcGFjZS5mbGFnc1t0aGlzLm5hbWVdPSEwLHRoaXMubmFtZXNwYWNlLmVtaXQuYXBwbHkodGhpcy5uYW1lc3BhY2UsYXJndW1lbnRzKX19KCJ1bmRlZmluZWQiIT10eXBlb2YgaW8/aW86bW9kdWxlLmV4cG9ydHMsInVuZGVmaW5lZCIhPXR5cGVvZiBpbz9pbzptb2R1bGUucGFyZW50LmV4cG9ydHMpLGZ1bmN0aW9uKGEsYixjKXtmdW5jdGlvbiBkKGEpe2IuVHJhbnNwb3J0LmFwcGx5KHRoaXMsYXJndW1lbnRzKX1hLndlYnNvY2tldD1kLGIudXRpbC5pbmhlcml0KGQsYi5UcmFuc3BvcnQpLGQucHJvdG90eXBlLm5hbWU9IndlYnNvY2tldCIsZC5wcm90b3R5cGUub3Blbj1mdW5jdGlvbigpe3ZhciBhPWIudXRpbC5xdWVyeSh0aGlzLnNvY2tldC5vcHRpb25zLnF1ZXJ5KSxkPXRoaXMsZTtlfHwoZT1jLk1veldlYlNvY2tldHx8Yy5XZWJTb2NrZXQpLHRoaXMud2Vic29ja2V0PW5ldyBlKHRoaXMucHJlcGFyZVVybCgpK2EpLHRoaXMud2Vic29ja2V0Lm9ub3Blbj1mdW5jdGlvbigpe2Qub25PcGVuKCksZC5zb2NrZXQuc2V0QnVmZmVyKCExKX0sdGhpcy53ZWJzb2NrZXQub25tZXNzYWdlPWZ1bmN0aW9uKGEpe2Qub25EYXRhKGEuZGF0YSl9LHRoaXMud2Vic29ja2V0Lm9uY2xvc2U9ZnVuY3Rpb24oKXtkLm9uQ2xvc2UoKSxkLnNvY2tldC5zZXRCdWZmZXIoITApfSx0aGlzLndlYnNvY2tldC5vbmVycm9yPWZ1bmN0aW9uKGEpe2Qub25FcnJvcihhKX07cmV0dXJuIHRoaXN9LGQucHJvdG90eXBlLnNlbmQ9ZnVuY3Rpb24oYSl7dGhpcy53ZWJzb2NrZXQuc2VuZChhKTtyZXR1cm4gdGhpc30sZC5wcm90b3R5cGUucGF5bG9hZD1mdW5jdGlvbihhKXtmb3IodmFyIGI9MCxjPWEubGVuZ3RoO2I8YztiKyspdGhpcy5wYWNrZXQoYVtiXSk7cmV0dXJuIHRoaXN9LGQucHJvdG90eXBlLmNsb3NlPWZ1bmN0aW9uKCl7dGhpcy53ZWJzb2NrZXQuY2xvc2UoKTtyZXR1cm4gdGhpc30sZC5wcm90b3R5cGUub25FcnJvcj1mdW5jdGlvbihhKXt0aGlzLnNvY2tldC5vbkVycm9yKGEpfSxkLnByb3RvdHlwZS5zY2hlbWU9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zb2NrZXQub3B0aW9ucy5zZWN1cmU/IndzcyI6IndzIn0sZC5jaGVjaz1mdW5jdGlvbigpe3JldHVybiJXZWJTb2NrZXQiaW4gYyYmISgiX19hZGRUYXNrImluIFdlYlNvY2tldCl8fCJNb3pXZWJTb2NrZXQiaW4gY30sZC54ZG9tYWluQ2hlY2s9ZnVuY3Rpb24oKXtyZXR1cm4hMH0sYi50cmFuc3BvcnRzLnB1c2goIndlYnNvY2tldCIpfSgidW5kZWZpbmVkIiE9dHlwZW9mIGlvP2lvLlRyYW5zcG9ydDptb2R1bGUuZXhwb3J0cywidW5kZWZpbmVkIiE9dHlwZW9mIGlvP2lvOm1vZHVsZS5wYXJlbnQuZXhwb3J0cyx0aGlzKSxmdW5jdGlvbihhLGIpe2Z1bmN0aW9uIGMoKXtiLlRyYW5zcG9ydC53ZWJzb2NrZXQuYXBwbHkodGhpcyxhcmd1bWVudHMpfWEuZmxhc2hzb2NrZXQ9YyxiLnV0aWwuaW5oZXJpdChjLGIuVHJhbnNwb3J0LndlYnNvY2tldCksYy5wcm90b3R5cGUubmFtZT0iZmxhc2hzb2NrZXQiLGMucHJvdG90eXBlLm9wZW49ZnVuY3Rpb24oKXt2YXIgYT10aGlzLGM9YXJndW1lbnRzO1dlYlNvY2tldC5fX2FkZFRhc2soZnVuY3Rpb24oKXtiLlRyYW5zcG9ydC53ZWJzb2NrZXQucHJvdG90eXBlLm9wZW4uYXBwbHkoYSxjKX0pO3JldHVybiB0aGlzfSxjLnByb3RvdHlwZS5zZW5kPWZ1bmN0aW9uKCl7dmFyIGE9dGhpcyxjPWFyZ3VtZW50cztXZWJTb2NrZXQuX19hZGRUYXNrKGZ1bmN0aW9uKCl7Yi5UcmFuc3BvcnQud2Vic29ja2V0LnByb3RvdHlwZS5zZW5kLmFwcGx5KGEsYyl9KTtyZXR1cm4gdGhpc30sYy5wcm90b3R5cGUuY2xvc2U9ZnVuY3Rpb24oKXtXZWJTb2NrZXQuX190YXNrcy5sZW5ndGg9MCxiLlRyYW5zcG9ydC53ZWJzb2NrZXQucHJvdG90eXBlLmNsb3NlLmNhbGwodGhpcyk7cmV0dXJuIHRoaXN9LGMucHJvdG90eXBlLnJlYWR5PWZ1bmN0aW9uKGEsZCl7ZnVuY3Rpb24gZSgpe3ZhciBiPWEub3B0aW9ucyxlPWJbImZsYXNoIHBvbGljeSBwb3J0Il0sZz1bImh0dHAiKyhiLnNlY3VyZT8icyI6IiIpKyI6LyIsYi5ob3N0KyI6IitiLnBvcnQsYi5yZXNvdXJjZSwic3RhdGljL2ZsYXNoc29ja2V0IiwiV2ViU29ja2V0TWFpbiIrKGEuaXNYRG9tYWluKCk/Ikluc2VjdXJlIjoiIikrIi5zd2YiXTtjLmxvYWRlZHx8KHR5cGVvZiBXRUJfU09DS0VUX1NXRl9MT0NBVElPTj09InVuZGVmaW5lZCImJihXRUJfU09DS0VUX1NXRl9MT0NBVElPTj1nLmpvaW4oIi8iKSksZSE9PTg0MyYmV2ViU29ja2V0LmxvYWRGbGFzaFBvbGljeUZpbGUoInhtbHNvY2tldDovLyIrYi5ob3N0KyI6IitlKSxXZWJTb2NrZXQuX19pbml0aWFsaXplKCksYy5sb2FkZWQ9ITApLGQuY2FsbChmKX12YXIgZj10aGlzO2lmKGRvY3VtZW50LmJvZHkpcmV0dXJuIGUoKTtiLnV0aWwubG9hZChlKX0sYy5jaGVjaz1mdW5jdGlvbigpe3JldHVybiB0eXBlb2YgV2ViU29ja2V0IT0idW5kZWZpbmVkIiYmIl9faW5pdGlhbGl6ZSJpbiBXZWJTb2NrZXQmJiEhc3dmb2JqZWN0P3N3Zm9iamVjdC5nZXRGbGFzaFBsYXllclZlcnNpb24oKS5tYWpvcj49MTA6ITF9LGMueGRvbWFpbkNoZWNrPWZ1bmN0aW9uKCl7cmV0dXJuITB9LHR5cGVvZiB3aW5kb3chPSJ1bmRlZmluZWQiJiYoV0VCX1NPQ0tFVF9ESVNBQkxFX0FVVE9fSU5JVElBTElaQVRJT049ITApLGIudHJhbnNwb3J0cy5wdXNoKCJmbGFzaHNvY2tldCIpfSgidW5kZWZpbmVkIiE9dHlwZW9mIGlvP2lvLlRyYW5zcG9ydDptb2R1bGUuZXhwb3J0cywidW5kZWZpbmVkIiE9dHlwZW9mIGlvP2lvOm1vZHVsZS5wYXJlbnQuZXhwb3J0cyk7aWYoInVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3cpdmFyIHN3Zm9iamVjdD1mdW5jdGlvbigpe2Z1bmN0aW9uIFYoYil7dmFyIGM9L1tcXFwiPD5cLjtdLyxkPWMuZXhlYyhiKSE9bnVsbDtyZXR1cm4gZCYmdHlwZW9mIGVuY29kZVVSSUNvbXBvbmVudCE9YT9lbmNvZGVVUklDb21wb25lbnQoYik6Yn1mdW5jdGlvbiBVKGEsYil7aWYoISF4KXt2YXIgYz1iPyJ2aXNpYmxlIjoiaGlkZGVuIjt0JiZQKGEpP1AoYSkuc3R5bGUudmlzaWJpbGl0eT1jOlQoIiMiK2EsInZpc2liaWxpdHk6IitjKX19ZnVuY3Rpb24gVChjLGQsZSxmKXtpZigheS5pZXx8IXkubWFjKXt2YXIgZz1pLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJoZWFkIilbMF07aWYoIWcpcmV0dXJuO3ZhciBoPWUmJnR5cGVvZiBlPT0ic3RyaW5nIj9lOiJzY3JlZW4iO2YmJih2PW51bGwsdz1udWxsKTtpZighdnx8dyE9aCl7dmFyIGo9USgic3R5bGUiKTtqLnNldEF0dHJpYnV0ZSgidHlwZSIsInRleHQvY3NzIiksai5zZXRBdHRyaWJ1dGUoIm1lZGlhIixoKSx2PWcuYXBwZW5kQ2hpbGQoaikseS5pZSYmeS53aW4mJnR5cGVvZiBpLnN0eWxlU2hlZXRzIT1hJiZpLnN0eWxlU2hlZXRzLmxlbmd0aD4wJiYodj1pLnN0eWxlU2hlZXRzW2kuc3R5bGVTaGVldHMubGVuZ3RoLTFdKSx3PWh9eS5pZSYmeS53aW4/diYmdHlwZW9mIHYuYWRkUnVsZT09YiYmdi5hZGRSdWxlKGMsZCk6diYmdHlwZW9mIGkuY3JlYXRlVGV4dE5vZGUhPWEmJnYuYXBwZW5kQ2hpbGQoaS5jcmVhdGVUZXh0Tm9kZShjKyIgeyIrZCsifSIpKX19ZnVuY3Rpb24gUyhhKXt2YXIgYj15LnB2LGM9YS5zcGxpdCgiLiIpO2NbMF09cGFyc2VJbnQoY1swXSwxMCksY1sxXT1wYXJzZUludChjWzFdLDEwKXx8MCxjWzJdPXBhcnNlSW50KGNbMl0sMTApfHwwO3JldHVybiBiWzBdPmNbMF18fGJbMF09PWNbMF0mJmJbMV0+Y1sxXXx8YlswXT09Y1swXSYmYlsxXT09Y1sxXSYmYlsyXT49Y1syXT8hMDohMX1mdW5jdGlvbiBSKGEsYixjKXthLmF0dGFjaEV2ZW50KGIsYyksb1tvLmxlbmd0aF09W2EsYixjXX1mdW5jdGlvbiBRKGEpe3JldHVybiBpLmNyZWF0ZUVsZW1lbnQoYSl9ZnVuY3Rpb24gUChhKXt2YXIgYj1udWxsO3RyeXtiPWkuZ2V0RWxlbWVudEJ5SWQoYSl9Y2F0Y2goYyl7fXJldHVybiBifWZ1bmN0aW9uIE8oYSl7dmFyIGI9UChhKTtpZihiKXtmb3IodmFyIGMgaW4gYil0eXBlb2YgYltjXT09ImZ1bmN0aW9uIiYmKGJbY109bnVsbCk7Yi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGIpfX1mdW5jdGlvbiBOKGEpe3ZhciBiPVAoYSk7YiYmYi5ub2RlTmFtZT09Ik9CSkVDVCImJih5LmllJiZ5Lndpbj8oYi5zdHlsZS5kaXNwbGF5PSJub25lIixmdW5jdGlvbigpe2IucmVhZHlTdGF0ZT09ND9PKGEpOnNldFRpbWVvdXQoYXJndW1lbnRzLmNhbGxlZSwxMCl9KCkpOmIucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChiKSl9ZnVuY3Rpb24gTShhLGIsYyl7dmFyIGQ9USgicGFyYW0iKTtkLnNldEF0dHJpYnV0ZSgibmFtZSIsYiksZC5zZXRBdHRyaWJ1dGUoInZhbHVlIixjKSxhLmFwcGVuZENoaWxkKGQpfWZ1bmN0aW9uIEwoYyxkLGYpe3ZhciBnLGg9UChmKTtpZih5LndrJiZ5LndrPDMxMilyZXR1cm4gZztpZihoKXt0eXBlb2YgYy5pZD09YSYmKGMuaWQ9Zik7aWYoeS5pZSYmeS53aW4pe3ZhciBpPSIiO2Zvcih2YXIgaiBpbiBjKWNbal0hPU9iamVjdC5wcm90b3R5cGVbal0mJihqLnRvTG93ZXJDYXNlKCk9PSJkYXRhIj9kLm1vdmllPWNbal06ai50b0xvd2VyQ2FzZSgpPT0ic3R5bGVjbGFzcyI/aSs9JyBjbGFzcz0iJytjW2pdKyciJzpqLnRvTG93ZXJDYXNlKCkhPSJjbGFzc2lkIiYmKGkrPSIgIitqKyc9IicrY1tqXSsnIicpKTt2YXIgaz0iIjtmb3IodmFyIGwgaW4gZClkW2xdIT1PYmplY3QucHJvdG90eXBlW2xdJiYoays9JzxwYXJhbSBuYW1lPSInK2wrJyIgdmFsdWU9IicrZFtsXSsnIiAvPicpO2gub3V0ZXJIVE1MPSc8b2JqZWN0IGNsYXNzaWQ9ImNsc2lkOkQyN0NEQjZFLUFFNkQtMTFjZi05NkI4LTQ0NDU1MzU0MDAwMCInK2krIj4iK2srIjwvb2JqZWN0PiIsbltuLmxlbmd0aF09Yy5pZCxnPVAoYy5pZCl9ZWxzZXt2YXIgbT1RKGIpO20uc2V0QXR0cmlidXRlKCJ0eXBlIixlKTtmb3IodmFyIG8gaW4gYyljW29dIT1PYmplY3QucHJvdG90eXBlW29dJiYoby50b0xvd2VyQ2FzZSgpPT0ic3R5bGVjbGFzcyI/bS5zZXRBdHRyaWJ1dGUoImNsYXNzIixjW29dKTpvLnRvTG93ZXJDYXNlKCkhPSJjbGFzc2lkIiYmbS5zZXRBdHRyaWJ1dGUobyxjW29dKSk7Zm9yKHZhciBwIGluIGQpZFtwXSE9T2JqZWN0LnByb3RvdHlwZVtwXSYmcC50b0xvd2VyQ2FzZSgpIT0ibW92aWUiJiZNKG0scCxkW3BdKTtoLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKG0saCksZz1tfX1yZXR1cm4gZ31mdW5jdGlvbiBLKGEpe3ZhciBjPVEoImRpdiIpO2lmKHkud2luJiZ5LmllKWMuaW5uZXJIVE1MPWEuaW5uZXJIVE1MO2Vsc2V7dmFyIGQ9YS5nZXRFbGVtZW50c0J5VGFnTmFtZShiKVswXTtpZihkKXt2YXIgZT1kLmNoaWxkTm9kZXM7aWYoZSl7dmFyIGY9ZS5sZW5ndGg7Zm9yKHZhciBnPTA7ZzxmO2crKykoZVtnXS5ub2RlVHlwZSE9MXx8ZVtnXS5ub2RlTmFtZSE9IlBBUkFNIikmJmVbZ10ubm9kZVR5cGUhPTgmJmMuYXBwZW5kQ2hpbGQoZVtnXS5jbG9uZU5vZGUoITApKX19fXJldHVybiBjfWZ1bmN0aW9uIEooYSl7aWYoeS5pZSYmeS53aW4mJmEucmVhZHlTdGF0ZSE9NCl7dmFyIGI9USgiZGl2Iik7YS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShiLGEpLGIucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQoSyhhKSxiKSxhLnN0eWxlLmRpc3BsYXk9Im5vbmUiLGZ1bmN0aW9uKCl7YS5yZWFkeVN0YXRlPT00P2EucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChhKTpzZXRUaW1lb3V0KGFyZ3VtZW50cy5jYWxsZWUsMTApfSgpfWVsc2UgYS5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZChLKGEpLGEpfWZ1bmN0aW9uIEkoYixjLGQsZSl7dT0hMCxyPWV8fG51bGwscz17c3VjY2VzczohMSxpZDpkfTt2YXIgZz1QKGQpO2lmKGcpe2cubm9kZU5hbWU9PSJPQkpFQ1QiPyhwPUsoZykscT1udWxsKToocD1nLHE9ZCksYi5pZD1mO2lmKHR5cGVvZiBiLndpZHRoPT1hfHwhLyUkLy50ZXN0KGIud2lkdGgpJiZwYXJzZUludChiLndpZHRoLDEwKTwzMTApYi53aWR0aD0iMzEwIjtpZih0eXBlb2YgYi5oZWlnaHQ9PWF8fCEvJSQvLnRlc3QoYi5oZWlnaHQpJiZwYXJzZUludChiLmhlaWdodCwxMCk8MTM3KWIuaGVpZ2h0PSIxMzciO2kudGl0bGU9aS50aXRsZS5zbGljZSgwLDQ3KSsiIC0gRmxhc2ggUGxheWVyIEluc3RhbGxhdGlvbiI7dmFyIGo9eS5pZSYmeS53aW4/IkFjdGl2ZVgiOiJQbHVnSW4iLGs9Ik1NcmVkaXJlY3RVUkw9IitoLmxvY2F0aW9uLnRvU3RyaW5nKCkucmVwbGFjZSgvJi9nLCIlMjYiKSsiJk1NcGxheWVyVHlwZT0iK2orIiZNTWRvY3RpdGxlPSIraS50aXRsZTt0eXBlb2YgYy5mbGFzaHZhcnMhPWE/Yy5mbGFzaHZhcnMrPSImIitrOmMuZmxhc2h2YXJzPWs7aWYoeS5pZSYmeS53aW4mJmcucmVhZHlTdGF0ZSE9NCl7dmFyIGw9USgiZGl2Iik7ZCs9IlNXRk9iamVjdE5ldyIsbC5zZXRBdHRyaWJ1dGUoImlkIixkKSxnLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGwsZyksZy5zdHlsZS5kaXNwbGF5PSJub25lIixmdW5jdGlvbigpe2cucmVhZHlTdGF0ZT09ND9nLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZyk6c2V0VGltZW91dChhcmd1bWVudHMuY2FsbGVlLDEwKX0oKX1MKGIsYyxkKX19ZnVuY3Rpb24gSCgpe3JldHVybiF1JiZTKCI2LjAuNjUiKSYmKHkud2lufHx5Lm1hYykmJiEoeS53ayYmeS53azwzMTIpfWZ1bmN0aW9uIEcoYyl7dmFyIGQ9bnVsbCxlPVAoYyk7aWYoZSYmZS5ub2RlTmFtZT09Ik9CSkVDVCIpaWYodHlwZW9mIGUuU2V0VmFyaWFibGUhPWEpZD1lO2Vsc2V7dmFyIGY9ZS5nZXRFbGVtZW50c0J5VGFnTmFtZShiKVswXTtmJiYoZD1mKX1yZXR1cm4gZH1mdW5jdGlvbiBGKCl7dmFyIGI9bS5sZW5ndGg7aWYoYj4wKWZvcih2YXIgYz0wO2M8YjtjKyspe3ZhciBkPW1bY10uaWQsZT1tW2NdLmNhbGxiYWNrRm4sZj17c3VjY2VzczohMSxpZDpkfTtpZih5LnB2WzBdPjApe3ZhciBnPVAoZCk7aWYoZylpZihTKG1bY10uc3dmVmVyc2lvbikmJiEoeS53ayYmeS53azwzMTIpKVUoZCwhMCksZSYmKGYuc3VjY2Vzcz0hMCxmLnJlZj1HKGQpLGUoZikpO2Vsc2UgaWYobVtjXS5leHByZXNzSW5zdGFsbCYmSCgpKXt2YXIgaD17fTtoLmRhdGE9bVtjXS5leHByZXNzSW5zdGFsbCxoLndpZHRoPWcuZ2V0QXR0cmlidXRlKCJ3aWR0aCIpfHwiMCIsaC5oZWlnaHQ9Zy5nZXRBdHRyaWJ1dGUoImhlaWdodCIpfHwiMCIsZy5nZXRBdHRyaWJ1dGUoImNsYXNzIikmJihoLnN0eWxlY2xhc3M9Zy5nZXRBdHRyaWJ1dGUoImNsYXNzIikpLGcuZ2V0QXR0cmlidXRlKCJhbGlnbiIpJiYoaC5hbGlnbj1nLmdldEF0dHJpYnV0ZSgiYWxpZ24iKSk7dmFyIGk9e30saj1nLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJwYXJhbSIpLGs9ai5sZW5ndGg7Zm9yKHZhciBsPTA7bDxrO2wrKylqW2xdLmdldEF0dHJpYnV0ZSgibmFtZSIpLnRvTG93ZXJDYXNlKCkhPSJtb3ZpZSImJihpW2pbbF0uZ2V0QXR0cmlidXRlKCJuYW1lIildPWpbbF0uZ2V0QXR0cmlidXRlKCJ2YWx1ZSIpKTtJKGgsaSxkLGUpfWVsc2UgSihnKSxlJiZlKGYpfWVsc2V7VShkLCEwKTtpZihlKXt2YXIgbj1HKGQpO24mJnR5cGVvZiBuLlNldFZhcmlhYmxlIT1hJiYoZi5zdWNjZXNzPSEwLGYucmVmPW4pLGUoZil9fX19ZnVuY3Rpb24gRSgpe3ZhciBjPWkuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJvZHkiKVswXSxkPVEoYik7ZC5zZXRBdHRyaWJ1dGUoInR5cGUiLGUpO3ZhciBmPWMuYXBwZW5kQ2hpbGQoZCk7aWYoZil7dmFyIGc9MDsoZnVuY3Rpb24oKXtpZih0eXBlb2YgZi5HZXRWYXJpYWJsZSE9YSl7dmFyIGI9Zi5HZXRWYXJpYWJsZSgiJHZlcnNpb24iKTtiJiYoYj1iLnNwbGl0KCIgIilbMV0uc3BsaXQoIiwiKSx5LnB2PVtwYXJzZUludChiWzBdLDEwKSxwYXJzZUludChiWzFdLDEwKSxwYXJzZUludChiWzJdLDEwKV0pfWVsc2UgaWYoZzwxMCl7ZysrLHNldFRpbWVvdXQoYXJndW1lbnRzLmNhbGxlZSwxMCk7cmV0dXJufWMucmVtb3ZlQ2hpbGQoZCksZj1udWxsLEYoKX0pKCl9ZWxzZSBGKCl9ZnVuY3Rpb24gRCgpe2s/RSgpOkYoKX1mdW5jdGlvbiBDKGIpe2lmKHR5cGVvZiBoLmFkZEV2ZW50TGlzdGVuZXIhPWEpaC5hZGRFdmVudExpc3RlbmVyKCJsb2FkIixiLCExKTtlbHNlIGlmKHR5cGVvZiBpLmFkZEV2ZW50TGlzdGVuZXIhPWEpaS5hZGRFdmVudExpc3RlbmVyKCJsb2FkIixiLCExKTtlbHNlIGlmKHR5cGVvZiBoLmF0dGFjaEV2ZW50IT1hKVIoaCwib25sb2FkIixiKTtlbHNlIGlmKHR5cGVvZiBoLm9ubG9hZD09ImZ1bmN0aW9uIil7dmFyIGM9aC5vbmxvYWQ7aC5vbmxvYWQ9ZnVuY3Rpb24oKXtjKCksYigpfX1lbHNlIGgub25sb2FkPWJ9ZnVuY3Rpb24gQihhKXt0P2EoKTpsW2wubGVuZ3RoXT1hfWZ1bmN0aW9uIEEoKXtpZighdCl7dHJ5e3ZhciBhPWkuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJvZHkiKVswXS5hcHBlbmRDaGlsZChRKCJzcGFuIikpO2EucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChhKX1jYXRjaChiKXtyZXR1cm59dD0hMDt2YXIgYz1sLmxlbmd0aDtmb3IodmFyIGQ9MDtkPGM7ZCsrKWxbZF0oKX19dmFyIGE9InVuZGVmaW5lZCIsYj0ib2JqZWN0IixjPSJTaG9ja3dhdmUgRmxhc2giLGQ9IlNob2Nrd2F2ZUZsYXNoLlNob2Nrd2F2ZUZsYXNoIixlPSJhcHBsaWNhdGlvbi94LXNob2Nrd2F2ZS1mbGFzaCIsZj0iU1dGT2JqZWN0RXhwckluc3QiLGc9Im9ucmVhZHlzdGF0ZWNoYW5nZSIsaD13aW5kb3csaT1kb2N1bWVudCxqPW5hdmlnYXRvcixrPSExLGw9W0RdLG09W10sbj1bXSxvPVtdLHAscSxyLHMsdD0hMSx1PSExLHYsdyx4PSEwLHk9ZnVuY3Rpb24oKXt2YXIgZj10eXBlb2YgaS5nZXRFbGVtZW50QnlJZCE9YSYmdHlwZW9mIGkuZ2V0RWxlbWVudHNCeVRhZ05hbWUhPWEmJnR5cGVvZiBpLmNyZWF0ZUVsZW1lbnQhPWEsZz1qLnVzZXJBZ2VudC50b0xvd2VyQ2FzZSgpLGw9ai5wbGF0Zm9ybS50b0xvd2VyQ2FzZSgpLG09bD8vd2luLy50ZXN0KGwpOi93aW4vLnRlc3QoZyksbj1sPy9tYWMvLnRlc3QobCk6L21hYy8udGVzdChnKSxvPS93ZWJraXQvLnRlc3QoZyk/cGFyc2VGbG9hdChnLnJlcGxhY2UoL14uKndlYmtpdFwvKFxkKyhcLlxkKyk/KS4qJC8sIiQxIikpOiExLHA9ITEscT1bMCwwLDBdLHI9bnVsbDtpZih0eXBlb2Ygai5wbHVnaW5zIT1hJiZ0eXBlb2Ygai5wbHVnaW5zW2NdPT1iKXI9ai5wbHVnaW5zW2NdLmRlc2NyaXB0aW9uLHImJih0eXBlb2Ygai5taW1lVHlwZXM9PWF8fCFqLm1pbWVUeXBlc1tlXXx8ISFqLm1pbWVUeXBlc1tlXS5lbmFibGVkUGx1Z2luKSYmKGs9ITAscD0hMSxyPXIucmVwbGFjZSgvXi4qXHMrKFxTK1xzK1xTKyQpLywiJDEiKSxxWzBdPXBhcnNlSW50KHIucmVwbGFjZSgvXiguKilcLi4qJC8sIiQxIiksMTApLHFbMV09cGFyc2VJbnQoci5yZXBsYWNlKC9eLipcLiguKilccy4qJC8sIiQxIiksMTApLHFbMl09L1thLXpBLVpdLy50ZXN0KHIpP3BhcnNlSW50KHIucmVwbGFjZSgvXi4qW2EtekEtWl0rKC4qKSQvLCIkMSIpLDEwKTowKTtlbHNlIGlmKHR5cGVvZiBoLkFjdGl2ZVhPYmplY3QhPWEpdHJ5e3ZhciBzPW5ldyBBY3RpdmVYT2JqZWN0KGQpO3MmJihyPXMuR2V0VmFyaWFibGUoIiR2ZXJzaW9uIiksciYmKHA9ITAscj1yLnNwbGl0KCIgIilbMV0uc3BsaXQoIiwiKSxxPVtwYXJzZUludChyWzBdLDEwKSxwYXJzZUludChyWzFdLDEwKSxwYXJzZUludChyWzJdLDEwKV0pKX1jYXRjaCh0KXt9cmV0dXJue3czOmYscHY6cSx3azpvLGllOnAsd2luOm0sbWFjOm59fSgpLHo9ZnVuY3Rpb24oKXsheS53M3x8KCh0eXBlb2YgaS5yZWFkeVN0YXRlIT1hJiZpLnJlYWR5U3RhdGU9PSJjb21wbGV0ZSJ8fHR5cGVvZiBpLnJlYWR5U3RhdGU9PWEmJihpLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJib2R5IilbMF18fGkuYm9keSkpJiZBKCksdHx8KHR5cGVvZiBpLmFkZEV2ZW50TGlzdGVuZXIhPWEmJmkuYWRkRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsQSwhMSkseS5pZSYmeS53aW4mJihpLmF0dGFjaEV2ZW50KGcsZnVuY3Rpb24oKXtpLnJlYWR5U3RhdGU9PSJjb21wbGV0ZSImJihpLmRldGFjaEV2ZW50KGcsYXJndW1lbnRzLmNhbGxlZSksQSgpKX0pLGg9PXRvcCYmZnVuY3Rpb24oKXtpZighdCl7dHJ5e2kuZG9jdW1lbnRFbGVtZW50LmRvU2Nyb2xsKCJsZWZ0Iil9Y2F0Y2goYSl7c2V0VGltZW91dChhcmd1bWVudHMuY2FsbGVlLDApO3JldHVybn1BKCl9fSgpKSx5LndrJiZmdW5jdGlvbigpe2lmKCF0KXtpZighL2xvYWRlZHxjb21wbGV0ZS8udGVzdChpLnJlYWR5U3RhdGUpKXtzZXRUaW1lb3V0KGFyZ3VtZW50cy5jYWxsZWUsMCk7cmV0dXJufUEoKX19KCksQyhBKSkpfSgpLFc9ZnVuY3Rpb24oKXt5LmllJiZ5LndpbiYmd2luZG93LmF0dGFjaEV2ZW50KCJvbnVubG9hZCIsZnVuY3Rpb24oKXt2YXIgYT1vLmxlbmd0aDtmb3IodmFyIGI9MDtiPGE7YisrKW9bYl1bMF0uZGV0YWNoRXZlbnQob1tiXVsxXSxvW2JdWzJdKTt2YXIgYz1uLmxlbmd0aDtmb3IodmFyIGQ9MDtkPGM7ZCsrKU4obltkXSk7Zm9yKHZhciBlIGluIHkpeVtlXT1udWxsO3k9bnVsbDtmb3IodmFyIGYgaW4gc3dmb2JqZWN0KXN3Zm9iamVjdFtmXT1udWxsO3N3Zm9iamVjdD1udWxsfSl9KCk7cmV0dXJue3JlZ2lzdGVyT2JqZWN0OmZ1bmN0aW9uKGEsYixjLGQpe2lmKHkudzMmJmEmJmIpe3ZhciBlPXt9O2UuaWQ9YSxlLnN3ZlZlcnNpb249YixlLmV4cHJlc3NJbnN0YWxsPWMsZS5jYWxsYmFja0ZuPWQsbVttLmxlbmd0aF09ZSxVKGEsITEpfWVsc2UgZCYmZCh7c3VjY2VzczohMSxpZDphfSl9LGdldE9iamVjdEJ5SWQ6ZnVuY3Rpb24oYSl7aWYoeS53MylyZXR1cm4gRyhhKX0sZW1iZWRTV0Y6ZnVuY3Rpb24oYyxkLGUsZixnLGgsaSxqLGssbCl7dmFyIG09e3N1Y2Nlc3M6ITEsaWQ6ZH07eS53MyYmISh5LndrJiZ5LndrPDMxMikmJmMmJmQmJmUmJmYmJmc/KFUoZCwhMSksQihmdW5jdGlvbigpe2UrPSIiLGYrPSIiO3ZhciBuPXt9O2lmKGsmJnR5cGVvZiBrPT09Yilmb3IodmFyIG8gaW4gayluW29dPWtbb107bi5kYXRhPWMsbi53aWR0aD1lLG4uaGVpZ2h0PWY7dmFyIHA9e307aWYoaiYmdHlwZW9mIGo9PT1iKWZvcih2YXIgcSBpbiBqKXBbcV09altxXTtpZihpJiZ0eXBlb2YgaT09PWIpZm9yKHZhciByIGluIGkpdHlwZW9mIHAuZmxhc2h2YXJzIT1hP3AuZmxhc2h2YXJzKz0iJiIrcisiPSIraVtyXTpwLmZsYXNodmFycz1yKyI9IitpW3JdO2lmKFMoZykpe3ZhciBzPUwobixwLGQpO24uaWQ9PWQmJlUoZCwhMCksbS5zdWNjZXNzPSEwLG0ucmVmPXN9ZWxzZXtpZihoJiZIKCkpe24uZGF0YT1oLEkobixwLGQsbCk7cmV0dXJufVUoZCwhMCl9bCYmbChtKX0pKTpsJiZsKG0pfSxzd2l0Y2hPZmZBdXRvSGlkZVNob3c6ZnVuY3Rpb24oKXt4PSExfSx1YTp5LGdldEZsYXNoUGxheWVyVmVyc2lvbjpmdW5jdGlvbigpe3JldHVybnttYWpvcjp5LnB2WzBdLG1pbm9yOnkucHZbMV0scmVsZWFzZTp5LnB2WzJdfX0saGFzRmxhc2hQbGF5ZXJWZXJzaW9uOlMsY3JlYXRlU1dGOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4geS53Mz9MKGEsYixjKTp1bmRlZmluZWR9LHNob3dFeHByZXNzSW5zdGFsbDpmdW5jdGlvbihhLGIsYyxkKXt5LnczJiZIKCkmJkkoYSxiLGMsZCl9LHJlbW92ZVNXRjpmdW5jdGlvbihhKXt5LnczJiZOKGEpfSxjcmVhdGVDU1M6ZnVuY3Rpb24oYSxiLGMsZCl7eS53MyYmVChhLGIsYyxkKX0sYWRkRG9tTG9hZEV2ZW50OkIsYWRkTG9hZEV2ZW50OkMsZ2V0UXVlcnlQYXJhbVZhbHVlOmZ1bmN0aW9uKGEpe3ZhciBiPWkubG9jYXRpb24uc2VhcmNofHxpLmxvY2F0aW9uLmhhc2g7aWYoYil7L1w/Ly50ZXN0KGIpJiYoYj1iLnNwbGl0KCI/IilbMV0pO2lmKGE9PW51bGwpcmV0dXJuIFYoYik7dmFyIGM9Yi5zcGxpdCgiJiIpO2Zvcih2YXIgZD0wO2Q8Yy5sZW5ndGg7ZCsrKWlmKGNbZF0uc3Vic3RyaW5nKDAsY1tkXS5pbmRleE9mKCI9IikpPT1hKXJldHVybiBWKGNbZF0uc3Vic3RyaW5nKGNbZF0uaW5kZXhPZigiPSIpKzEpKX1yZXR1cm4iIn0sZXhwcmVzc0luc3RhbGxDYWxsYmFjazpmdW5jdGlvbigpe2lmKHUpe3ZhciBhPVAoZik7YSYmcCYmKGEucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQocCxhKSxxJiYoVShxLCEwKSx5LmllJiZ5LndpbiYmKHAuc3R5bGUuZGlzcGxheT0iYmxvY2siKSksciYmcihzKSksdT0hMX19fX0oKTsoZnVuY3Rpb24oKXtpZigidW5kZWZpbmVkIiE9dHlwZW9mIHdpbmRvdyYmIXdpbmRvdy5XZWJTb2NrZXQpe3ZhciBhPXdpbmRvdy5jb25zb2xlO2lmKCFhfHwhYS5sb2d8fCFhLmVycm9yKWE9e2xvZzpmdW5jdGlvbigpe30sZXJyb3I6ZnVuY3Rpb24oKXt9fTtpZighc3dmb2JqZWN0Lmhhc0ZsYXNoUGxheWVyVmVyc2lvbigiMTAuMC4wIikpe2EuZXJyb3IoIkZsYXNoIFBsYXllciA+PSAxMC4wLjAgaXMgcmVxdWlyZWQuIik7cmV0dXJufWxvY2F0aW9uLnByb3RvY29sPT0iZmlsZToiJiZhLmVycm9yKCJXQVJOSU5HOiB3ZWItc29ja2V0LWpzIGRvZXNuJ3Qgd29yayBpbiBmaWxlOi8vLy4uLiBVUkwgdW5sZXNzIHlvdSBzZXQgRmxhc2ggU2VjdXJpdHkgU2V0dGluZ3MgcHJvcGVybHkuIE9wZW4gdGhlIHBhZ2UgdmlhIFdlYiBzZXJ2ZXIgaS5lLiBodHRwOi8vLi4uIiksV2ViU29ja2V0PWZ1bmN0aW9uKGEsYixjLGQsZSl7dmFyIGY9dGhpcztmLl9faWQ9V2ViU29ja2V0Ll9fbmV4dElkKyssV2ViU29ja2V0Ll9faW5zdGFuY2VzW2YuX19pZF09ZixmLnJlYWR5U3RhdGU9V2ViU29ja2V0LkNPTk5FQ1RJTkcsZi5idWZmZXJlZEFtb3VudD0wLGYuX19ldmVudHM9e30sYj90eXBlb2YgYj09InN0cmluZyImJihiPVtiXSk6Yj1bXSxzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7V2ViU29ja2V0Ll9fYWRkVGFzayhmdW5jdGlvbigpe1dlYlNvY2tldC5fX2ZsYXNoLmNyZWF0ZShmLl9faWQsYSxiLGN8fG51bGwsZHx8MCxlfHxudWxsKX0pfSwwKX0sV2ViU29ja2V0LnByb3RvdHlwZS5zZW5kPWZ1bmN0aW9uKGEpe2lmKHRoaXMucmVhZHlTdGF0ZT09V2ViU29ja2V0LkNPTk5FQ1RJTkcpdGhyb3ciSU5WQUxJRF9TVEFURV9FUlI6IFdlYiBTb2NrZXQgY29ubmVjdGlvbiBoYXMgbm90IGJlZW4gZXN0YWJsaXNoZWQiO3ZhciBiPVdlYlNvY2tldC5fX2ZsYXNoLnNlbmQodGhpcy5fX2lkLGVuY29kZVVSSUNvbXBvbmVudChhKSk7aWYoYjwwKXJldHVybiEwO3RoaXMuYnVmZmVyZWRBbW91bnQrPWI7cmV0dXJuITF9LFdlYlNvY2tldC5wcm90b3R5cGUuY2xvc2U9ZnVuY3Rpb24oKXt0aGlzLnJlYWR5U3RhdGUhPVdlYlNvY2tldC5DTE9TRUQmJnRoaXMucmVhZHlTdGF0ZSE9V2ViU29ja2V0LkNMT1NJTkcmJih0aGlzLnJlYWR5U3RhdGU9V2ViU29ja2V0LkNMT1NJTkcsV2ViU29ja2V0Ll9fZmxhc2guY2xvc2UodGhpcy5fX2lkKSl9LFdlYlNvY2tldC5wcm90b3R5cGUuYWRkRXZlbnRMaXN0ZW5lcj1mdW5jdGlvbihhLGIsYyl7YSBpbiB0aGlzLl9fZXZlbnRzfHwodGhpcy5fX2V2ZW50c1thXT1bXSksdGhpcy5fX2V2ZW50c1thXS5wdXNoKGIpfSxXZWJTb2NrZXQucHJvdG90eXBlLnJlbW92ZUV2ZW50TGlzdGVuZXI9ZnVuY3Rpb24oYSxiLGMpe2lmKGEgaW4gdGhpcy5fX2V2ZW50cyl7dmFyIGQ9dGhpcy5fX2V2ZW50c1thXTtmb3IodmFyIGU9ZC5sZW5ndGgtMTtlPj0wOy0tZSlpZihkW2VdPT09Yil7ZC5zcGxpY2UoZSwxKTticmVha319fSxXZWJTb2NrZXQucHJvdG90eXBlLmRpc3BhdGNoRXZlbnQ9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5fX2V2ZW50c1thLnR5cGVdfHxbXTtmb3IodmFyIGM9MDtjPGIubGVuZ3RoOysrYyliW2NdKGEpO3ZhciBkPXRoaXNbIm9uIithLnR5cGVdO2QmJmQoYSl9LFdlYlNvY2tldC5wcm90b3R5cGUuX19oYW5kbGVFdmVudD1mdW5jdGlvbihhKXsicmVhZHlTdGF0ZSJpbiBhJiYodGhpcy5yZWFkeVN0YXRlPWEucmVhZHlTdGF0ZSksInByb3RvY29sImluIGEmJih0aGlzLnByb3RvY29sPWEucHJvdG9jb2wpO3ZhciBiO2lmKGEudHlwZT09Im9wZW4ifHxhLnR5cGU9PSJlcnJvciIpYj10aGlzLl9fY3JlYXRlU2ltcGxlRXZlbnQoYS50eXBlKTtlbHNlIGlmKGEudHlwZT09ImNsb3NlIiliPXRoaXMuX19jcmVhdGVTaW1wbGVFdmVudCgiY2xvc2UiKTtlbHNle2lmKGEudHlwZSE9Im1lc3NhZ2UiKXRocm93InVua25vd24gZXZlbnQgdHlwZTogIithLnR5cGU7dmFyIGM9ZGVjb2RlVVJJQ29tcG9uZW50KGEubWVzc2FnZSk7Yj10aGlzLl9fY3JlYXRlTWVzc2FnZUV2ZW50KCJtZXNzYWdlIixjKX10aGlzLmRpc3BhdGNoRXZlbnQoYil9LFdlYlNvY2tldC5wcm90b3R5cGUuX19jcmVhdGVTaW1wbGVFdmVudD1mdW5jdGlvbihhKXtpZihkb2N1bWVudC5jcmVhdGVFdmVudCYmd2luZG93LkV2ZW50KXt2YXIgYj1kb2N1bWVudC5jcmVhdGVFdmVudCgiRXZlbnQiKTtiLmluaXRFdmVudChhLCExLCExKTtyZXR1cm4gYn1yZXR1cm57dHlwZTphLGJ1YmJsZXM6ITEsY2FuY2VsYWJsZTohMX19LFdlYlNvY2tldC5wcm90b3R5cGUuX19jcmVhdGVNZXNzYWdlRXZlbnQ9ZnVuY3Rpb24oYSxiKXtpZihkb2N1bWVudC5jcmVhdGVFdmVudCYmd2luZG93Lk1lc3NhZ2VFdmVudCYmIXdpbmRvdy5vcGVyYSl7dmFyIGM9ZG9jdW1lbnQuY3JlYXRlRXZlbnQoIk1lc3NhZ2VFdmVudCIpO2MuaW5pdE1lc3NhZ2VFdmVudCgibWVzc2FnZSIsITEsITEsYixudWxsLG51bGwsd2luZG93LG51bGwpO3JldHVybiBjfXJldHVybnt0eXBlOmEsZGF0YTpiLGJ1YmJsZXM6ITEsY2FuY2VsYWJsZTohMX19LFdlYlNvY2tldC5DT05ORUNUSU5HPTAsV2ViU29ja2V0Lk9QRU49MSxXZWJTb2NrZXQuQ0xPU0lORz0yLFdlYlNvY2tldC5DTE9TRUQ9MyxXZWJTb2NrZXQuX19mbGFzaD1udWxsLFdlYlNvY2tldC5fX2luc3RhbmNlcz17fSxXZWJTb2NrZXQuX190YXNrcz1bXSxXZWJTb2NrZXQuX19uZXh0SWQ9MCxXZWJTb2NrZXQubG9hZEZsYXNoUG9saWN5RmlsZT1mdW5jdGlvbihhKXtXZWJTb2NrZXQuX19hZGRUYXNrKGZ1bmN0aW9uKCl7V2ViU29ja2V0Ll9fZmxhc2gubG9hZE1hbnVhbFBvbGljeUZpbGUoYSl9KX0sV2ViU29ja2V0Ll9faW5pdGlhbGl6ZT1mdW5jdGlvbigpe2lmKCFXZWJTb2NrZXQuX19mbGFzaCl7V2ViU29ja2V0Ll9fc3dmTG9jYXRpb24mJih3aW5kb3cuV0VCX1NPQ0tFVF9TV0ZfTE9DQVRJT049V2ViU29ja2V0Ll9fc3dmTG9jYXRpb24pO2lmKCF3aW5kb3cuV0VCX1NPQ0tFVF9TV0ZfTE9DQVRJT04pe2EuZXJyb3IoIltXZWJTb2NrZXRdIHNldCBXRUJfU09DS0VUX1NXRl9MT0NBVElPTiB0byBsb2NhdGlvbiBvZiBXZWJTb2NrZXRNYWluLnN3ZiIpO3JldHVybn12YXIgYj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTtiLmlkPSJ3ZWJTb2NrZXRDb250YWluZXIiLGIuc3R5bGUucG9zaXRpb249ImFic29sdXRlIixXZWJTb2NrZXQuX19pc0ZsYXNoTGl0ZSgpPyhiLnN0eWxlLmxlZnQ9IjBweCIsYi5zdHlsZS50b3A9IjBweCIpOihiLnN0eWxlLmxlZnQ9Ii0xMDBweCIsYi5zdHlsZS50b3A9Ii0xMDBweCIpO3ZhciBjPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpO2MuaWQ9IndlYlNvY2tldEZsYXNoIixiLmFwcGVuZENoaWxkKGMpLGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYiksc3dmb2JqZWN0LmVtYmVkU1dGKFdFQl9TT0NLRVRfU1dGX0xPQ0FUSU9OLCJ3ZWJTb2NrZXRGbGFzaCIsIjEiLCIxIiwiMTAuMC4wIixudWxsLG51bGwse2hhc1ByaW9yaXR5OiEwLHN3bGl2ZWNvbm5lY3Q6ITAsYWxsb3dTY3JpcHRBY2Nlc3M6ImFsd2F5cyJ9LG51bGwsZnVuY3Rpb24oYil7Yi5zdWNjZXNzfHxhLmVycm9yKCJbV2ViU29ja2V0XSBzd2ZvYmplY3QuZW1iZWRTV0YgZmFpbGVkIil9KX19LFdlYlNvY2tldC5fX29uRmxhc2hJbml0aWFsaXplZD1mdW5jdGlvbigpe3NldFRpbWVvdXQoZnVuY3Rpb24oKXtXZWJTb2NrZXQuX19mbGFzaD1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgid2ViU29ja2V0Rmxhc2giKSxXZWJTb2NrZXQuX19mbGFzaC5zZXRDYWxsZXJVcmwobG9jYXRpb24uaHJlZiksV2ViU29ja2V0Ll9fZmxhc2guc2V0RGVidWcoISF3aW5kb3cuV0VCX1NPQ0tFVF9ERUJVRyk7Zm9yKHZhciBhPTA7YTxXZWJTb2NrZXQuX190YXNrcy5sZW5ndGg7KythKVdlYlNvY2tldC5fX3Rhc2tzW2FdKCk7V2ViU29ja2V0Ll9fdGFza3M9W119LDApfSxXZWJTb2NrZXQuX19vbkZsYXNoRXZlbnQ9ZnVuY3Rpb24oKXtzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7dHJ5e3ZhciBiPVdlYlNvY2tldC5fX2ZsYXNoLnJlY2VpdmVFdmVudHMoKTtmb3IodmFyIGM9MDtjPGIubGVuZ3RoOysrYylXZWJTb2NrZXQuX19pbnN0YW5jZXNbYltjXS53ZWJTb2NrZXRJZF0uX19oYW5kbGVFdmVudChiW2NdKX1jYXRjaChkKXthLmVycm9yKGQpfX0sMCk7cmV0dXJuITB9LFdlYlNvY2tldC5fX2xvZz1mdW5jdGlvbihiKXthLmxvZyhkZWNvZGVVUklDb21wb25lbnQoYikpfSxXZWJTb2NrZXQuX19lcnJvcj1mdW5jdGlvbihiKXthLmVycm9yKGRlY29kZVVSSUNvbXBvbmVudChiKSl9LFdlYlNvY2tldC5fX2FkZFRhc2s9ZnVuY3Rpb24oYSl7V2ViU29ja2V0Ll9fZmxhc2g/YSgpOldlYlNvY2tldC5fX3Rhc2tzLnB1c2goYSl9LFdlYlNvY2tldC5fX2lzRmxhc2hMaXRlPWZ1bmN0aW9uKCl7aWYoIXdpbmRvdy5uYXZpZ2F0b3J8fCF3aW5kb3cubmF2aWdhdG9yLm1pbWVUeXBlcylyZXR1cm4hMTt2YXIgYT13aW5kb3cubmF2aWdhdG9yLm1pbWVUeXBlc1siYXBwbGljYXRpb24veC1zaG9ja3dhdmUtZmxhc2giXTtyZXR1cm4hYXx8IWEuZW5hYmxlZFBsdWdpbnx8IWEuZW5hYmxlZFBsdWdpbi5maWxlbmFtZT8hMTphLmVuYWJsZWRQbHVnaW4uZmlsZW5hbWUubWF0Y2goL2ZsYXNobGl0ZS9pKT8hMDohMX0sd2luZG93LldFQl9TT0NLRVRfRElTQUJMRV9BVVRPX0lOSVRJQUxJWkFUSU9OfHwod2luZG93LmFkZEV2ZW50TGlzdGVuZXI/d2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImxvYWQiLGZ1bmN0aW9uKCl7V2ViU29ja2V0Ll9faW5pdGlhbGl6ZSgpfSwhMSk6d2luZG93LmF0dGFjaEV2ZW50KCJvbmxvYWQiLGZ1bmN0aW9uKCl7V2ViU29ja2V0Ll9faW5pdGlhbGl6ZSgpfSkpfX0pKCksZnVuY3Rpb24oYSxiLGMpe2Z1bmN0aW9uIGUoKXt9ZnVuY3Rpb24gZChhKXshYXx8KGIuVHJhbnNwb3J0LmFwcGx5KHRoaXMsYXJndW1lbnRzKSx0aGlzLnNlbmRCdWZmZXI9W10pfWEuWEhSPWQsYi51dGlsLmluaGVyaXQoZCxiLlRyYW5zcG9ydCksZC5wcm90b3R5cGUub3Blbj1mdW5jdGlvbigpe3RoaXMuc29ja2V0LnNldEJ1ZmZlcighMSksdGhpcy5vbk9wZW4oKSx0aGlzLmdldCgpLHRoaXMuc2V0Q2xvc2VUaW1lb3V0KCk7cmV0dXJuIHRoaXN9LGQucHJvdG90eXBlLnBheWxvYWQ9ZnVuY3Rpb24oYSl7dmFyIGM9W107Zm9yKHZhciBkPTAsZT1hLmxlbmd0aDtkPGU7ZCsrKWMucHVzaChiLnBhcnNlci5lbmNvZGVQYWNrZXQoYVtkXSkpO3RoaXMuc2VuZChiLnBhcnNlci5lbmNvZGVQYXlsb2FkKGMpKX0sZC5wcm90b3R5cGUuc2VuZD1mdW5jdGlvbihhKXt0aGlzLnBvc3QoYSk7cmV0dXJuIHRoaXN9LGQucHJvdG90eXBlLnBvc3Q9ZnVuY3Rpb24oYSl7ZnVuY3Rpb24gZigpe3RoaXMub25sb2FkPWUsYi5zb2NrZXQuc2V0QnVmZmVyKCExKX1mdW5jdGlvbiBkKCl7dGhpcy5yZWFkeVN0YXRlPT00JiYodGhpcy5vbnJlYWR5c3RhdGVjaGFuZ2U9ZSxiLnBvc3Rpbmc9ITEsdGhpcy5zdGF0dXM9PTIwMD9iLnNvY2tldC5zZXRCdWZmZXIoITEpOmIub25DbG9zZSgpKX12YXIgYj10aGlzO3RoaXMuc29ja2V0LnNldEJ1ZmZlcighMCksdGhpcy5zZW5kWEhSPXRoaXMucmVxdWVzdCgiUE9TVCIpLGMuWERvbWFpblJlcXVlc3QmJnRoaXMuc2VuZFhIUiBpbnN0YW5jZW9mIFhEb21haW5SZXF1ZXN0P3RoaXMuc2VuZFhIUi5vbmxvYWQ9dGhpcy5zZW5kWEhSLm9uZXJyb3I9Zjp0aGlzLnNlbmRYSFIub25yZWFkeXN0YXRlY2hhbmdlPWQsdGhpcy5zZW5kWEhSLnNlbmQoYSl9LGQucHJvdG90eXBlLmNsb3NlPWZ1bmN0aW9uKCl7dGhpcy5vbkNsb3NlKCk7cmV0dXJuIHRoaXN9LGQucHJvdG90eXBlLnJlcXVlc3Q9ZnVuY3Rpb24oYSl7dmFyIGM9Yi51dGlsLnJlcXVlc3QodGhpcy5zb2NrZXQuaXNYRG9tYWluKCkpLGQ9Yi51dGlsLnF1ZXJ5KHRoaXMuc29ja2V0Lm9wdGlvbnMucXVlcnksInQ9IisgKyhuZXcgRGF0ZSkpO2Mub3BlbihhfHwiR0VUIix0aGlzLnByZXBhcmVVcmwoKStkLCEwKTtpZihhPT0iUE9TVCIpdHJ5e2Muc2V0UmVxdWVzdEhlYWRlcj9jLnNldFJlcXVlc3RIZWFkZXIoIkNvbnRlbnQtdHlwZSIsInRleHQvcGxhaW47Y2hhcnNldD1VVEYtOCIpOmMuY29udGVudFR5cGU9InRleHQvcGxhaW4ifWNhdGNoKGUpe31yZXR1cm4gY30sZC5wcm90b3R5cGUuc2NoZW1lPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuc29ja2V0Lm9wdGlvbnMuc2VjdXJlPyJodHRwcyI6Imh0dHAifSxkLmNoZWNrPWZ1bmN0aW9uKGEsYyl7dHJ5e2lmKGIudXRpbC5yZXF1ZXN0KGMpKXJldHVybiEwfWNhdGNoKGQpe31yZXR1cm4hMX0sZC54ZG9tYWluQ2hlY2s9ZnVuY3Rpb24oKXtyZXR1cm4gZC5jaGVjayhudWxsLCEwKX19KCJ1bmRlZmluZWQiIT10eXBlb2YgaW8/aW8uVHJhbnNwb3J0Om1vZHVsZS5leHBvcnRzLCJ1bmRlZmluZWQiIT10eXBlb2YgaW8/aW86bW9kdWxlLnBhcmVudC5leHBvcnRzLHRoaXMpLGZ1bmN0aW9uKGEsYil7ZnVuY3Rpb24gYyhhKXtiLlRyYW5zcG9ydC5YSFIuYXBwbHkodGhpcyxhcmd1bWVudHMpfWEuaHRtbGZpbGU9YyxiLnV0aWwuaW5oZXJpdChjLGIuVHJhbnNwb3J0LlhIUiksYy5wcm90b3R5cGUubmFtZT0iaHRtbGZpbGUiLGMucHJvdG90eXBlLmdldD1mdW5jdGlvbigpe3RoaXMuZG9jPW5ldyBBY3RpdmVYT2JqZWN0KCJodG1sZmlsZSIpLHRoaXMuZG9jLm9wZW4oKSx0aGlzLmRvYy53cml0ZSgiPGh0bWw+PC9odG1sPiIpLHRoaXMuZG9jLmNsb3NlKCksdGhpcy5kb2MucGFyZW50V2luZG93LnM9dGhpczt2YXIgYT10aGlzLmRvYy5jcmVhdGVFbGVtZW50KCJkaXYiKTthLmNsYXNzTmFtZT0ic29ja2V0aW8iLHRoaXMuZG9jLmJvZHkuYXBwZW5kQ2hpbGQoYSksdGhpcy5pZnJhbWU9dGhpcy5kb2MuY3JlYXRlRWxlbWVudCgiaWZyYW1lIiksYS5hcHBlbmRDaGlsZCh0aGlzLmlmcmFtZSk7dmFyIGM9dGhpcyxkPWIudXRpbC5xdWVyeSh0aGlzLnNvY2tldC5vcHRpb25zLnF1ZXJ5LCJ0PSIrICsobmV3IERhdGUpKTt0aGlzLmlmcmFtZS5zcmM9dGhpcy5wcmVwYXJlVXJsKCkrZCxiLnV0aWwub24od2luZG93LCJ1bmxvYWQiLGZ1bmN0aW9uKCl7Yy5kZXN0cm95KCl9KX0sYy5wcm90b3R5cGUuXz1mdW5jdGlvbihhLGIpe3RoaXMub25EYXRhKGEpO3RyeXt2YXIgYz1iLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJzY3JpcHQiKVswXTtjLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYyl9Y2F0Y2goZCl7fX0sYy5wcm90b3R5cGUuZGVzdHJveT1mdW5jdGlvbigpe2lmKHRoaXMuaWZyYW1lKXt0cnl7dGhpcy5pZnJhbWUuc3JjPSJhYm91dDpibGFuayJ9Y2F0Y2goYSl7fXRoaXMuZG9jPW51bGwsdGhpcy5pZnJhbWUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmlmcmFtZSksdGhpcy5pZnJhbWU9bnVsbCxDb2xsZWN0R2FyYmFnZSgpfX0sYy5wcm90b3R5cGUuY2xvc2U9ZnVuY3Rpb24oKXt0aGlzLmRlc3Ryb3koKTtyZXR1cm4gYi5UcmFuc3BvcnQuWEhSLnByb3RvdHlwZS5jbG9zZS5jYWxsKHRoaXMpfSxjLmNoZWNrPWZ1bmN0aW9uKCl7aWYoIkFjdGl2ZVhPYmplY3QiaW4gd2luZG93KXRyeXt2YXIgYT1uZXcgQWN0aXZlWE9iamVjdCgiaHRtbGZpbGUiKTtyZXR1cm4gYSYmYi5UcmFuc3BvcnQuWEhSLmNoZWNrKCl9Y2F0Y2goYyl7fXJldHVybiExfSxjLnhkb21haW5DaGVjaz1mdW5jdGlvbigpe3JldHVybiExfSxiLnRyYW5zcG9ydHMucHVzaCgiaHRtbGZpbGUiKX0oInVuZGVmaW5lZCIhPXR5cGVvZiBpbz9pby5UcmFuc3BvcnQ6bW9kdWxlLmV4cG9ydHMsInVuZGVmaW5lZCIhPXR5cGVvZiBpbz9pbzptb2R1bGUucGFyZW50LmV4cG9ydHMpLGZ1bmN0aW9uKGEsYixjKXtmdW5jdGlvbiBlKCl7fWZ1bmN0aW9uIGQoKXtiLlRyYW5zcG9ydC5YSFIuYXBwbHkodGhpcyxhcmd1bWVudHMpfWFbInhoci1wb2xsaW5nIl09ZCxiLnV0aWwuaW5oZXJpdChkLGIuVHJhbnNwb3J0LlhIUiksYi51dGlsLm1lcmdlKGQsYi5UcmFuc3BvcnQuWEhSKSxkLnByb3RvdHlwZS5uYW1lPSJ4aHItcG9sbGluZyIsZC5wcm90b3R5cGUub3Blbj1mdW5jdGlvbigpe3ZhciBhPXRoaXM7Yi5UcmFuc3BvcnQuWEhSLnByb3RvdHlwZS5vcGVuLmNhbGwoYSk7cmV0dXJuITF9LGQucHJvdG90eXBlLmdldD1mdW5jdGlvbigpe2Z1bmN0aW9uIGQoKXt0aGlzLm9ubG9hZD1lLGEub25EYXRhKHRoaXMucmVzcG9uc2VUZXh0KSxhLmdldCgpfWZ1bmN0aW9uIGIoKXt0aGlzLnJlYWR5U3RhdGU9PTQmJih0aGlzLm9ucmVhZHlzdGF0ZWNoYW5nZT1lLHRoaXMuc3RhdHVzPT0yMDA/KGEub25EYXRhKHRoaXMucmVzcG9uc2VUZXh0KSxhLmdldCgpKTphLm9uQ2xvc2UoKSl9aWYoISF0aGlzLm9wZW4pe3ZhciBhPXRoaXM7dGhpcy54aHI9dGhpcy5yZXF1ZXN0KCksYy5YRG9tYWluUmVxdWVzdCYmdGhpcy54aHIgaW5zdGFuY2VvZiBYRG9tYWluUmVxdWVzdD90aGlzLnhoci5vbmxvYWQ9dGhpcy54aHIub25lcnJvcj1kOnRoaXMueGhyLm9ucmVhZHlzdGF0ZWNoYW5nZT1iLHRoaXMueGhyLnNlbmQobnVsbCl9fSxkLnByb3RvdHlwZS5vbkNsb3NlPWZ1bmN0aW9uKCl7Yi5UcmFuc3BvcnQuWEhSLnByb3RvdHlwZS5vbkNsb3NlLmNhbGwodGhpcyk7aWYodGhpcy54aHIpe3RoaXMueGhyLm9ucmVhZHlzdGF0ZWNoYW5nZT10aGlzLnhoci5vbmxvYWQ9ZTt0cnl7dGhpcy54aHIuYWJvcnQoKX1jYXRjaChhKXt9dGhpcy54aHI9bnVsbH19LGQucHJvdG90eXBlLnJlYWR5PWZ1bmN0aW9uKGEsYyl7dmFyIGQ9dGhpcztiLnV0aWwuZGVmZXIoZnVuY3Rpb24oKXtjLmNhbGwoZCl9KX0sYi50cmFuc3BvcnRzLnB1c2goInhoci1wb2xsaW5nIil9KCJ1bmRlZmluZWQiIT10eXBlb2YgaW8/aW8uVHJhbnNwb3J0Om1vZHVsZS5leHBvcnRzLCJ1bmRlZmluZWQiIT10eXBlb2YgaW8/aW86bW9kdWxlLnBhcmVudC5leHBvcnRzLHRoaXMpLGZ1bmN0aW9uKGEsYixjKXtmdW5jdGlvbiBlKGEpe2IuVHJhbnNwb3J0WyJ4aHItcG9sbGluZyJdLmFwcGx5KHRoaXMsYXJndW1lbnRzKSx0aGlzLmluZGV4PWIuai5sZW5ndGg7dmFyIGM9dGhpcztiLmoucHVzaChmdW5jdGlvbihhKXtjLl8oYSl9KX12YXIgZD1jLmRvY3VtZW50JiYiTW96QXBwZWFyYW5jZSJpbiBjLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZTthWyJqc29ucC1wb2xsaW5nIl09ZSxiLnV0aWwuaW5oZXJpdChlLGIuVHJhbnNwb3J0WyJ4aHItcG9sbGluZyJdKSxlLnByb3RvdHlwZS5uYW1lPSJqc29ucC1wb2xsaW5nIixlLnByb3RvdHlwZS5wb3N0PWZ1bmN0aW9uKGEpe2Z1bmN0aW9uIGooKXtjLmlmcmFtZSYmYy5mb3JtLnJlbW92ZUNoaWxkKGMuaWZyYW1lKTt0cnl7aD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCc8aWZyYW1lIG5hbWU9IicrYy5pZnJhbWVJZCsnIj4nKX1jYXRjaChhKXtoPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlmcmFtZSIpLGgubmFtZT1jLmlmcmFtZUlkfWguaWQ9Yy5pZnJhbWVJZCxjLmZvcm0uYXBwZW5kQ2hpbGQoaCksYy5pZnJhbWU9aH1mdW5jdGlvbiBpKCl7aigpLGMuc29ja2V0LnNldEJ1ZmZlcighMSl9dmFyIGM9dGhpcyxkPWIudXRpbC5xdWVyeSh0aGlzLnNvY2tldC5vcHRpb25zLnF1ZXJ5LCJ0PSIrICsobmV3IERhdGUpKyImaT0iK3RoaXMuaW5kZXgpO2lmKCF0aGlzLmZvcm0pe3ZhciBlPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImZvcm0iKSxmPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRleHRhcmVhIiksZz10aGlzLmlmcmFtZUlkPSJzb2NrZXRpb19pZnJhbWVfIit0aGlzLmluZGV4LGg7ZS5jbGFzc05hbWU9InNvY2tldGlvIixlLnN0eWxlLnBvc2l0aW9uPSJhYnNvbHV0ZSIsZS5zdHlsZS50b3A9Ii0xMDAwcHgiLGUuc3R5bGUubGVmdD0iLTEwMDBweCIsZS50YXJnZXQ9ZyxlLm1ldGhvZD0iUE9TVCIsZS5zZXRBdHRyaWJ1dGUoImFjY2VwdC1jaGFyc2V0IiwidXRmLTgiKSxmLm5hbWU9ImQiLGUuYXBwZW5kQ2hpbGQoZiksZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChlKSx0aGlzLmZvcm09ZSx0aGlzLmFyZWE9Zn10aGlzLmZvcm0uYWN0aW9uPXRoaXMucHJlcGFyZVVybCgpK2QsaigpLHRoaXMuYXJlYS52YWx1ZT1iLkpTT04uc3RyaW5naWZ5KGEpO3RyeXt0aGlzLmZvcm0uc3VibWl0KCl9Y2F0Y2goayl7fXRoaXMuaWZyYW1lLmF0dGFjaEV2ZW50P2gub25yZWFkeXN0YXRlY2hhbmdlPWZ1bmN0aW9uKCl7Yy5pZnJhbWUucmVhZHlTdGF0ZT09ImNvbXBsZXRlIiYmaSgpfTp0aGlzLmlmcmFtZS5vbmxvYWQ9aSx0aGlzLnNvY2tldC5zZXRCdWZmZXIoITApfSxlLnByb3RvdHlwZS5nZXQ9ZnVuY3Rpb24oKXt2YXIgYT10aGlzLGM9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0IiksZT1iLnV0aWwucXVlcnkodGhpcy5zb2NrZXQub3B0aW9ucy5xdWVyeSwidD0iKyArKG5ldyBEYXRlKSsiJmk9Iit0aGlzLmluZGV4KTt0aGlzLnNjcmlwdCYmKHRoaXMuc2NyaXB0LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5zY3JpcHQpLHRoaXMuc2NyaXB0PW51bGwpLGMuYXN5bmM9ITAsYy5zcmM9dGhpcy5wcmVwYXJlVXJsKCkrZSxjLm9uZXJyb3I9ZnVuY3Rpb24oKXthLm9uQ2xvc2UoKX07dmFyIGY9ZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInNjcmlwdCIpWzBdO2YucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoYyxmKSx0aGlzLnNjcmlwdD1jLGQmJnNldFRpbWVvdXQoZnVuY3Rpb24oKXt2YXIgYT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpZnJhbWUiKTtkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGEpLGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoYSl9LDEwMCl9LGUucHJvdG90eXBlLl89ZnVuY3Rpb24oYSl7dGhpcy5vbkRhdGEoYSksdGhpcy5vcGVuJiZ0aGlzLmdldCgpO3JldHVybiB0aGlzfSxlLnByb3RvdHlwZS5yZWFkeT1mdW5jdGlvbihhLGMpe3ZhciBlPXRoaXM7aWYoIWQpcmV0dXJuIGMuY2FsbCh0aGlzKTtiLnV0aWwubG9hZChmdW5jdGlvbigpe2MuY2FsbChlKX0pfSxlLmNoZWNrPWZ1bmN0aW9uKCl7cmV0dXJuImRvY3VtZW50ImluIGN9LGUueGRvbWFpbkNoZWNrPWZ1bmN0aW9uKCl7cmV0dXJuITB9LGIudHJhbnNwb3J0cy5wdXNoKCJqc29ucC1wb2xsaW5nIil9KCJ1bmRlZmluZWQiIT10eXBlb2YgaW8/aW8uVHJhbnNwb3J0Om1vZHVsZS5leHBvcnRzLCJ1bmRlZmluZWQiIT10eXBlb2YgaW8/aW86bW9kdWxlLnBhcmVudC5leHBvcnRzLHRoaXMp') );
			
			$V8JS->php_reciver = function($Data) use ( $self )
			{
				$Data = explode(":", $Data, 3);
				$Type = $Data[0];
				$Connection = $Data[1];
				$Data = TSock::DecodeData($Data[2]);
				TSock::OnData( $self, $Connection, $Data, $Type );
			};

			$V8JS->php_connect = function($connectId) use ( $self )
			{
				TSock::OnConnect( $self, $connectId );
			};

			$V8JS->php_disconnect = function($connectId) use ( $self )
			{
			 	TSock::OnDisconnect( $self, $connectId );
			};
		}

		Public Static Function json_safe_encode($var)
		{
		   return json_encode(self::json_fix_cyr($var, false));
		}
		
		Public Static Function json_safe_decode($var)
		{
		   return self::json_fix_cyr( json_decode($var), true );
		}
		
		Public Static Function StringDecode($string)
		{
			 return iconv('utf-8', 'windows-1251', $string);;
		}
		
		Public Static Function StringEncode($string)
		{
			return iconv('windows-1251', 'utf-8', $string);
		}
		
		Public Static Function json_fix_cyr($var, $decode = false)
		{
		   if (is_array($var)) {
			   $new = array();
			   foreach ($var as $k => $v) {
				   $new[self::json_fix_cyr($k, $decode)] = json_fix_cyr($v, $decode);
			   }
			   $var = $new;
		   } elseif (is_object($var)) {
			   $vars = get_object_vars($var);
			   foreach ($vars as $m => $v) {
				   $var->$m = self::json_fix_cyr($v, $decode);
			   }
		   } elseif (is_string($var)) {
				if($decode)
					$var = self::StringDecode($var);
				else
					$var = self::StringEncode($var);
		   }
		   return $var;
		}
		
		Public Static Function DecodeData($data)
		{
			return self::json_safe_decode($data);
		}
		
		Public Static Function EncodeData($data)
		{
			return self::json_safe_encode(self::json_safe_encode($data));
		}
		
		Public Function Broadcast($data)
		{
			global $__TSock;
			$V8JS = $__TSock[$this->self];
			$data = self::EncodeData($data);
			$V8JS->Execute('socket.emit("public", '.$data.');');
		}
		
		Public Function Send($id, $data)
		{
			global $__TSock;
			$V8JS = $__TSock[$this->self];
			$data = self::EncodeData($data);
			$V8JS->Execute('socket.emit("private", "'.$id.'", '.$data.');');
		}
		
		Public Function __Connect( $IP = '127.0.0.1', $Port = 7777 )
		{
			global $__TSock;
			$this->__TSockInit($this->self);
			$V8JS = $__TSock[$this->self];
			$V8JS->Execute('socket = io.connect(\'http://'.$IP.':'.$Port.'\');
			socket.on(\'public\', function(data){ php_reciver(\'1:\'+data); });
			socket.on(\'private\', function(data){ php_reciver(\'2:\'+data); });
			socket.on(\'disconnect\', function(connectId){ php_disconnect(connectId); });
			socket.on(\'connect\', function(connectId){ php_connect(connectId); });');
		}
		
		Public Function Connect ( $IP = null, $Port = null )
		{
			IF($IP) $this->IP = $IP;
			IF($Port) $this->Port = $Port;
			$this->__Connect($this->IP,$this->Port);
		}
	}
?>
